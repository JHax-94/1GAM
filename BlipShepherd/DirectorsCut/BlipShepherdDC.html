<canvas height="510" id="ctx" style="border: 4px solid #000000;" width="720"></canvas>

<script type="text/javascript">
var ctx = document.getElementById("ctx").getContext("2d");
document.getElementById("ctx").setAttribute("tabindex", 0);
// - - - CLICK HANDLER - - -

function getMousePos(ctx, evt)
{
 var rect = document.getElementById("ctx").getBoundingClientRect();
 
 return{ x: evt.clientX-rect.left, y: evt.clientY - rect.top };

}

var keyPressBusy = false;

document.getElementById("ctx").addEventListener("keydown", function(e)
{ 
 //alert(e.keyCode + " " + titleScreen);
 
 if(TitleScreen == true && e.keyCode == 27)
 {
  if(confirm("Clear all save data?"))
  {
   localStorage.clear();
   
   for(var i = 0; i < 9; i ++)
   {
    customSlots[i] = 0;
   }
   
   for(var i = 0; i < 18; i ++)
   {
    trophies[i] = 'n';
   }

   
   localStorage.setItem("trophies", JSON.stringify(trophies));
   
   localStorage.setItem("customLvls", JSON.stringify(customSlots));
   
  }
  
  
 }



 if(keyPressBusy == false && gameOn == true)
 {
  keyPressBusy = true;
  
  if(Go == true)
  {
   //alert("Keycode: " +  String.fromCharCode(e.keycode));
  
   if(e.keyCode == 87 || e.keyCode == 38)
   {
    // UP
    if(playerPos[1] != 0 && gameBoard.tiles[playerPos[0]][playerPos[1]-1].getType() >= 0)
    {
     gameBoard.moveFrom();
     playerPos[1] --;
    }
    
   }
   else if(e.keyCode == 65 || e.keyCode == 37)
   {
    // LEFT
    if(playerPos[0] != 0 && gameBoard.tiles[playerPos[0]-1][playerPos[1]].getType() >= 0)
    {
     gameBoard.moveFrom();
    
     playerPos[0] --;
    }
   }
   else if(e.keyCode == 83 || e.keyCode == 40)
   {
    // DOWN
   
    if(playerPos[1] < 29 && gameBoard.tiles[playerPos[0]][playerPos[1]+1].getType() >= 0)
    { 
     gameBoard.moveFrom();
     playerPos[1] ++;
    }
   
   }
   else if(e.keyCode == 68 || e.keyCode == 39)
   {
    // RIGHT
    if(playerPos[0] < 47 && gameBoard.tiles[playerPos[0]+1][playerPos[1]].getType() >= 0)
    {
     gameBoard.moveFrom();
     playerPos[0] ++;
    }
   }
   else if(e.keyCode == 82)
   {
    // RESET
    clearInterval(LoopRun);
    if(!testMode)
    {
     gameBoard.clear();
     playLevel(lvlType);
      
    }
    else
    {
      
     Go = false;
     gameOn = false;
     
     gameBoard.clear();
     gameBoard.copy(tempBoard);
     LevelEdit();
      
    }
     
   }
   /*else if(e.keyCode == 80)
   {
    clearInterval(LoopRun);
    Go = false;
    Menu();
   }
   */
  }
  
  if(e.keyCode == 80)
  {
   // PAUSE
  
   if(Go == true)
   {
    clearInterval(LoopRun);
    Go = false;
    Menu();
   }
   else
   {
    //alert("PAUSE!");
   
    LoopRun = setInterval(gameLoop, 250);
    Go = true;
    Menu();
   }
  }
  
  gameBoard.moveTo();
  gameBoard.draw();
 }
}, false);

document.getElementById("ctx").addEventListener("keyup", function(e) 
{
 keyPressBusy = false;
 
 
}, false);

function Bounded(IN, lower, upper)
{
 var rVal = false;

 if(IN > lower && IN < upper)
 {
  rVal = true;
 }
 
 return rVal;
 
}



document.getElementById("ctx").addEventListener('click', function(evt)
{ 
 var mousePos = getMousePos(ctx, evt);
 
 //alert("Mouse position:\nX = " + mousePos.x + "\nY = " + mousePos.y);
 
 if(TitleScreen == true)
 {
  if(Bounded(mousePos.x, 120, 240) == true && Bounded(mousePos.y, 300, 330) == true)
  {
   TitleScreen = false;
   level = 0;
   //alert("Level Select");
   levelSelect();
  }
  else if(Bounded(mousePos.x,  480, 600) == true && Bounded(mousePos.y, 300, 330) == true)
  {
   TitleScreen = false;
   pageNo = 0;
   Instructions();
   
  }
  else if(Bounded(mousePos.x, 300, 420) == true && Bounded(mousePos.y, 400, 430) == true)
  {
   TitleScreen = false;
   level = 0;
   LevelEdit();
   
  }
 }
 else if(LevelSel == true)
 {
  if(Bounded(mousePos.x, 240, 480) == true && mousePos.y > 450)
  {
   LevelSel = false;
   level = 0;
   titleScreen();
  }
  else if(Bounded(mousePos.x, 0, 239) == true && mousePos.y > 450)
  {
   //alert("Custom button pressed!");
  
   LevelSel = false;
   level = 0;
   CustomLevels();
  }
  else if(Bounded(mousePos.x, 481, 720) == true && mousePos.y > 450)
  {
   //alert("Bonus button pressed!");
   LevelSel = false;
   level = 0;
   BonusLevels();
  }
  
  else
  {
   for(var row = 0; row < 3; row ++)
   {
    for(var col = 0; col < 3; col ++)
    {
     if(Bounded(mousePos.x, 130+2*90*col, 220+2*90*col) == true && Bounded(mousePos.y, 80+2*60*row, 140+2*60*row))
     {
      if(totalPoints >= unlockThresh[row*3+col])
      {
       level = 1+3*row+col;
       LevelSel = false;
       gameOn = true;
       Go = true;
       playLevel();
      }
     }
    }
   }
  }
  
  
 }
 else if(instructOn == true)
 {
  if(Bounded(mousePos.x, 240, 480) == true && mousePos.y > 450)
  {
   instructOn = false;
   titleScreen();
  }
  else if(Bounded(mousePos.x, 480, 720) == true && mousePos.y > 450)
  { 
   if(pageNo != 1)
   {
    pageNo ++;
    Instructions();
   }
  }
  else if(Bounded(mousePos.x, 0, 240) == true && mousePos.y > 450)
  {
   if(pageNo != 0)
   {
    pageNo --;
    Instructions();
   }
  }
  
  
 }
 else if(customLevels == true)
 {
  if(Bounded(mousePos.x, 240, 480) == true && mousePos.y > 450)
  {
   customLevels = false;
   level = 0;
   levelSelect();
  }
  else
  {
   for(var row = 0; row < 3; row ++)
   {
    for(var col = 0; col < 3; col ++)
    {
     if(Bounded(mousePos.x, 130+2*90*col, 220+2*90*col) == true && Bounded(mousePos.y, 80+2*60*row, 140+2*60*row))
     {
      var levelInd = 3*row+col;
      if(gameBoard.read(levelInd))
      {
       customLevels = false;
       gameOn = true;
       Go = true;
       
       tempBoard.copy(gameBoard);
       gameBoard.draw();
       playLevel("CUSTOM");
      }
     }
    }
   }
  }
  
  
 }
 else if(bonusLevels == true)
 {
  if(Bounded(mousePos.x, 240, 480) == true && mousePos.y > 450)
  {
   bonusLevels = false;
   level = 0;
   levelSelect();
   
  }
  else
  {
   for(var row = 0; row < 3; row ++)
   {
    for(var col = 0; col < 3; col ++)
    {
     if(Bounded(mousePos.x, 130+2*90*col, 220+2*90*col) == true && Bounded(mousePos.y, 80+2*60*row, 140+2*60*row))
     {
      level = 10+3*row+col;
      //alert("Load Bonus level " + (level-9) + "\nABS level: " + level);
      bonusLevels = false;
      gameOn = true;
      Go = true;
      playLevel();
     }
    }
   }
  }
 }
 else if(gameOn == true)
 {
  if(mousePos.y > 450)
  {
   if(Go == true)
   {
    if(Bounded(mousePos.x, 480, 600) == true)
    {
     // Reset Button
     
     clearInterval(LoopRun);
     if(!testMode)
     {
      gameBoard.clear();
      playLevel(lvlType);
      
     }
     else
     {
      
      Go = false;
      gameOn = false;
     
      gameBoard.clear();
      gameBoard.copy(tempBoard);
      LevelEdit();
      
     }
     
     
     
    }
    else if(Bounded(mousePos.x, 600, 720) == true)
    {
     if(!testMode)
     {
      // LEVEL SELECT BUTTON
            
      gameOn = false;
      Go = false;
      
      clearInterval(LoopRun);
      
      gameBoard.clear();
      levelSelect();
     }
     else
     {
      testMode = false;
      gameOn = false;
      Go = false;
      
      clearInterval(LoopRun);
      gameBoard.clear();
      editMode.clear();
      
      titleScreen();
      
      
     
     }
     
     
     
    }
    
    if(finishOn == true && Bounded(mousePos.x, 360, 480) == true)
    { 
     if(!testMode)
     {
      if(level >= 0)
      {
       // FINISH BUTTON
       if(trophies[level-1] == 'b')
       {
        if(trophy == 's' || trophy == 'g')
        {
         trophies[level-1] = trophy;
        }
       }
       else if(trophies[level-1] == 's')
       {
        if(trophy == 'g')
        {
         trophies[level-1] = trophy;
        }
       }
       else if(trophies[level-1] == 'n')     
       {
        trophies[level-1] = trophy;
       }
       
       localStorage.setItem("trophies", JSON.stringify(trophies));
      }
      
      gameOn = false;
      Go = false;
      
      VictoryOn = true;
     }
     else if(safe >= 100)
     {
      //clearInterval(LoopRun);
      
      gameOn = false;
      Go = false;
      //alert("SETTING canSave TO TRUE");
      testMode = false;
      canSave = true;
      
      
     }
     
     
     
     
    }
   }
  }
 }
 else if(VictoryOn == true)
 {
  VictoryOn = false;
  clearScreen();
  levelSelect();
 }
 else if(canSave)
 {  
  // SIMILAR TO LEVEL SELECT
  
  if(mousePos.y > 451)
  {
   if(Bounded(mousePos.x, 240, 480))
   {
    // CANCEL BUTTON
    clearInterval(LoopRun);
    canSave = false;
    testMode = false;
    //gameOn = false;
    finishOn = false;
    
    gameBoard.clear();
    
    gameBoard.copy(tempBoard);
    
    LevelEdit();
   }
  }
  else
  {
   for(var row = 0; row < 3; row ++)
   {
    for(var col = 0; col < 3; col ++)
    {
     if(Bounded(mousePos.x, 130+2*90*col, 220+2*90*col) == true && Bounded(mousePos.y, 80+2*60*row, 140+2*60*row))
     {
      clearInterval(LoopRun);
     
      var saveIndex = 3*row+col;
      var doSave = false;
      
      
      if(customSlots[saveIndex] == 0)
      {
       doSave = true;
      }
      else if(confirm("Overwrite slot?"))
      {      
       doSave = true;
      }
      
      if(doSave)
      {
       tempBoard.store(saveIndex);
       canSave = false;
       testMode = false;
       
       clearScreen();
       titleScreen();
      }
      
      
      
      
     }
    }
   }
  }
  
 }
 else if(Editor)
 {
  if(Bounded(mousePos.x, 660, 720) == true && mousePos.y > 451)
  {
   // QUIT
   testMode = false;
   Editor = false;
   editMode.clear();
   titleScreen();
  }
  else if(Bounded(mousePos.x, 600, 659) == true && mousePos.y > 451)
  {
   // CLEAR
   if(confirm("Are you sure you want to erase the board?"))
   {
    gameBoard.clear();
    editMode.clear();
    gameBoard.draw();
   }
  }
  else if(Bounded(mousePos.x, 540, 599) == true && mousePos.y > 451)
  {
   // TEST
   
  
   //alert("Test mode!");
   // MUST HAVE:
   //   - Conway
   //  - At least 1 blip
   //   - Pool
   var canContinue = true;
   
   if(!editMode.conwayPlaced)
   {
    canContinue = false;
    
    alert("Must place Conway [green] to continue!");
   }
   else if(!editMode.poolPlaced)
   {
    canContinue = false;
    
    alert("Must place Pool [blue] to continue!");
   }
   else if(editMode.blipCount < 1)
   {
    canContinue = false;
    
    alert("Must place at least one Blip [yellow] to continue!");
   }
   
   if(canContinue)
   {
    tempBoard.copy(gameBoard);
    
    testMode = true;
    Editor = false;
    
    gameOn = true;
    Go = true;
    
    playLevel();
    
    
   
   }
  }
  else if(Bounded(mousePos.x, 0, 89) == true && mousePos.y > 451)
  {
   // PLACE CONWAY
   editMode.changeSelection(0);
  }
  else if(Bounded(mousePos.x, 90, 179) == true && mousePos.y > 451)
  {
   // PLACE BLIPS
   editMode.changeSelection(1);
   
  }
  else if(Bounded(mousePos.x, 180, 269) == true && mousePos.y > 451)
  {
   // PLACE WALL
   editMode.changeSelection(2);
   
  }
  else if(Bounded(mousePos.x, 270, 359) == true && mousePos.y > 451)
  {
   // PLACE POOL
   editMode.changeSelection(3);
   
  }
  else if(Bounded(mousePos.x, 360, 449) == true && mousePos.y > 451)
  {
   // PLACE TURRET
   
   editMode.changeSelection(4);
  } 
  else if(Bounded(mousePos.x, 450, 539) == true && mousePos.y > 451)
  {
   // PLACE BIO TURRET
   
   editMode.changeSelection(5);
  }
  else
  {
   var mouseCol = Math.floor(mousePos.x/15);
   var mouseRow = Math.floor(mousePos.y/15);
  
   switch(editMode.placeSelection)
   {
   case 0:
   
    editMode.placeConway(mouseCol, mouseRow);
   
   break;
    
   case 1:
    
    editMode.placeBlip(mouseCol, mouseRow);
    
   break;
   
   case 2:
    
    editMode.placeWall(mouseCol, mouseRow);
    
   break;
   
   case 3:
    
    editMode.placeTurret(mouseCol, mouseRow);
    
   break;
   
   case 4:
    
    editMode.placeBio(mouseCol, mouseRow);
    
   break;
   
   case 5:
   
    editMode.placePool(mouseCol, mouseRow);
    
   break;
   
   
   }
   
   
  }
  
  
 }
  
 
}, false);

// - - - CLICK HANDLER *END* - - -

// - - - EDITOR CLASS - - -

function editor(editorName)
{
 this.blipCount = 0;

 this.Name = editorName;
 //alert(this.Name);
 this.conwayPlaced = false;
 this.poolPlaced = false;
 //alert(this.conwayPlaced);
 this.levelNum = 0;
 
 this.Conway_x = -1;
 this.Conway_y = -1;
 
 this.poolCentre_x = -1;
 this.poolCentre_y = -1;
 
 this.placeSelection = 0;

}

editor.prototype.changeSelection = function(changeSel)
{

 this.placeSelection = changeSel;
 this.refresh();
}

editor.prototype.refresh = function()
{
 gameBoard.draw();
 EditorMenu();

}

editor.prototype.clear =function()
{
 this.blipCount = 0;
 this.conwayPlaced = false;
 this.poolPlaced = false;
 this.levelNum = 0;
 this.Conway_x = -1;
 this.Conway_y = -1;
 
 this.poolCentre_x = -1;
 this.poolCentre_y = -1;
 
 this.placeSelection = 0;
 
 this.refresh();
}

editor.prototype.placeBlip = function(_x, _y)
{
 
 if(typeof(_x) == "undefined") _x = 0;
 if(typeof(_y) == "undefined") _y = 0;
 
 if(gameBoard.tiles[_x][_y].type == 0)
 {
  gameBoard.tiles[_x][_y].addLife();
  this.blipCount ++;
 
 }
 else if(gameBoard.tiles[_x][_y].type == 1)
 {
  gameBoard.tiles[_x][_y].kill();
  this.blipCount --;
 }
 this.refresh();
}

editor.prototype.placeWall = function(_x, _y)
{
 if(typeof(_x) == "undefined") _x = 0;
 if(typeof(_y) == "undefined") _y = 0;
 
 if(gameBoard.tiles[_x][_y].type == 0)
 {
  gameBoard.tiles[_x][_y].addWall();
 
 }
 else if(gameBoard.tiles[_x][_y].type == -1)
 {
  gameBoard.tiles[_x][_y].kill();
 }
 this.refresh();

}

editor.prototype.placeTurret = function(_x, _y)
{
 if(typeof(_x) == "undefined") _x = 0;
 if(typeof(_y) == "undefined") _y = 0;
 
 if(gameBoard.tiles[_x][_y].type == 0)
 {
  gameBoard.tiles[_x][_y].addTurret();
 
 }
 else if(gameBoard.tiles[_x][_y].type == -3)
 {
  gameBoard.tiles[_x][_y].kill();
 }
 this.refresh();

}

editor.prototype.placeBio = function(_x, _y)
{

 if(typeof(_x) == "undefined") _x = 0;
 if(typeof(_y) == "undefined") _y = 0;
 
 if(gameBoard.tiles[_x][_y].type == 0)
 {
  gameBoard.tiles[_x][_y].addBioTurret();
 
 }
 else if(gameBoard.tiles[_x][_y].type == -5)
 {
  gameBoard.tiles[_x][_y].kill();
 }
 this.refresh();
}

editor.prototype.removePool = function()
{
 for(var i = -1; i < 2; i ++)
 {
  for(var j = -1; j < 2; j ++)
  {
   gameBoard.tiles[this.poolCentre_x+i][this.poolCentre_y+j].kill();
  
  }
 
 }

}


editor.prototype.placePool = function(_x, _y)
{
 if(typeof(_x) == "undefined") _x = 0;
 if(typeof(_y) == "undefined") _y = 0;
 
 var areaClear = true;
 var overwrite = false;
 
 if(_x < 1 || _x > 46)
 {
  areaClear = false;
 }
 else if(_y < 1 || _y > 28)
 {
  areaClear = false;
 }
 else
 {
  for(var i = -1; i < 2; i ++)
  {   
   for(var j = -1; j < 2; j ++)
   {
    if(gameBoard.tiles[_x+i][_y+j].type != 0)
    {
     if(gameBoard.tiles[_x+i][_y+j].type != -2)
     {
      areaClear = false;
     }
     else
     {
      overwrite = true;
     }
    }
   }
  }
 }
 
 
 if(areaClear)
 {
  if(_x != this.poolCentre_x || _y != this.poolCentre_y)
  {
   if(this.poolPlaced)
   {
    editMode.removePool();
   }
  
   gameBoard.addPool(_x, _y);
  
   this.poolCentre_x = _x;
   this.poolCentre_y = _y;
   
   this.poolPlaced = true;
  }
  else
  {
   
   this.removePool();
   this.poolPlaced = false;
   this.poolCentre_x = -1;
   this.poolCentre_y = -1;
  }
 
 }
 
 
 
 this.refresh();

}

editor.prototype.placeConway = function(_x, _y)
{
 //alert(this.Name);
 //alert(this.conwayPlaced);
 
 if(typeof(_x) == "undefined") _x = 0;
 if(typeof(_y) == "undefined") _y = 0;
 
 if(gameBoard.tiles[_x][_y].type == 0)
 {
  if(this.conwayPlaced)
  {
   gameBoard.tiles[this.Conway_x][this.Conway_y].kill();
  }
  else
  {
   this.conwayPlaced = true;
  }
  
  
  gameBoard.tiles[_x][_y].addPlayer();
   
  this.Conway_x = _x;
  this.Conway_y = _y;
  
  
 }
 else if(gameBoard.tiles[_x][_y].type == 2)
 {
  gameBoard.tiles[_x][_y].kill();
  
  this.Conway_x = -1;
  this.Conway_y = -1;
  
  this.conwayPlaced = false;
  
 }
  
 
 this.refresh();
}


// - - - - - - - - - - - -

// - - - TILE CLASS - - -

function tile(col, row, type)
{
 

 if(typeof(type) == "undefined") type = 0;
 else console.log("Construct with Type " + type);
 this.col = col;
 this.row = row;
 this.type = type;
 this.colour = "white";
 this.x_vel = 0;
 this.y_vel = 0;
 this.moved = false;
 this.count = 0;
 
 
 if(type != 0)
 {
  switch(type)
  {
   case -5:
    //alert("Adding bio turret");
    
    this.addBioTurret();
   
   break;
  
   case -3:
    //alert("Adding turret");
   
    this.addTurret();
   break;
   
   
   case -2:
   
   // alert("Adding Pool");
   
    this.addPool();
   
   break;
  
  
   case -1:
   // alert("Adding Wall");
   
    this.addWall();
   
   break;
  
   case 1:
   // alert("Adding Life");
   
    this.addLife();
   
   break;
   
   case 2: 
   // alert("Adding Player");
   
    this.addPlayer();
    
   break;
  
  }
 }
 
 
}
/*
function tile(newTile)
{
 this.col = newTile.col;
 this.row = newTile.row;
 this.type = newTile.type;
 this.colour = newTile.colour;
 this.x_vel = newTile.x_vel;
 this.y_vel = newTile.y_vel;
 this.moved = newTile.moved;
 this.count = newTile.count;


}*/

tile.prototype.addLife = function()
{
 this.type = 1;
 this.colour = "yellow";
}

tile.prototype.addPlayer = function()
{
 this.type = 2;
 this.colour = "green";
}

tile.prototype.addWall = function()
{
 this.type = -1;
 this.colour = "black";
}

tile.prototype.addPool = function()
{
 this.type = -2;
 this.colour = "blue";
 
}

tile.prototype.addTurret = function()
{
 this.type = -3;
 this.colour = "brown";
 this.count = 30;
}

tile.prototype.addBioTurret = function()
{
 this.type = -5;
 this.colour = "mediumvioletred";
 this.count = 30;
}

tile.prototype.addBullet = function(dir, vel, moved)
{
 if(this.getType() == 0)
 {
  if(typeof(dir)==='undefined') dir = 'none';
  if(typeof(vel)==='undefined') vel = 0;
  if(typeof(moved)==='undefined') moved = false;
  
  this.type = -4;
  this.colour = "red";
  /*if(this.x_vel > 0)
  { 
   this.moved = moved;
  }
  if(this.y_vel > 0)
  {
   this.moved = moved;
  }*/
  this.moved = moved;
  
  if(vel <= 0)
  {
   this.moved = false;
  }
  
  if(dir == 'x')
  {
   this.x_vel = vel;
  }
  else if(dir == 'y')
  {
   this.y_vel = vel;
  } 
 }
}

tile.prototype.addBio = function(dir, vel, moved)
{
 if(this.getType() == 0)
 {
  if(typeof(dir)==='undefined') dir = 'none';
  if(typeof(vel)==='undefined') vel = 0;
  if(typeof(moved)==='undefined') moved = false;
  
  this.type = 3;
  this.colour = "purple";
  this.moved = moved;
  
  if(vel <= 0)
  {
   this.moved = false
  }
  
  if(dir == 'x')
  {
   this.x_vel = vel;
  }
  else if(dir == 'y')
  {
   this.y_vel = vel;
  }
 }
}

tile.prototype.hasDir = function()
{
 var rVal = true;
 
 if(this.dir == 'none')
 {
  rVal = false;
 }
 
 return rVal;
}


tile.prototype.bulletMoved = function()
{
 var rVal = this.moved;
 
 if(this.moved == true)
 {
  this.moved = false;
 }
 
 return rVal;
 
}

tile.prototype.fireBullet = function(dir, vel)
{
 if(this.getType() == -4 || this.getType() == 3)
 {
  if(dir == 'x')
  {
   this.x_vel = vel;
  }
  else if(dir == 'y')
  {
   this.y_vel = vel;
  }
 }
}

tile.prototype.kill = function()
{
 this.type = 0;
 this.colour = "white";
 this.x_vel = 0;
 this.y_vel = 0;
}

tile.prototype.alive = function()
{
 var living;
 
 if(this.type > 0)
 {
  living = true;
 }
 else
 {
  living = false;
 }
 
 return living;
}

tile.prototype.getType = function()
{
 return this.type;
}

tile.prototype.getCount = function()
{
 return this.count;
}

tile.prototype.doCount = function()
{
 if(this.count == 0)
 {
  this.count = 40;
 }
 else
 {
  this.count = this.count - 1;
 }
 
 
}

tile.prototype.draw = function()
{

 ctx.beginPath();
 ctx.lineWidth = "0.75";
 ctx.strokeStyle = "black";
 ctx.rect(15*this.col, 15*this.row, 15, 15);
 ctx.fillStyle = this.colour;
 ctx.fillRect(15*this.col, 15*this.row, 15, 15);
 ctx.stroke();
}

tile.prototype.flip = function()
{
 if(this.col != playerPos[0] || this.row != playerPos[1])
 {
  if(this.getType() == 1)
  {
   this.type = 0;
   this.colour = "white";
  }
  else if(this.getType() == 0)
  {
   this.type = 1;
   this.colour = "yellow";
  }
 }
}


 
// - - - TILE CLASS *END* - - -

// - - - GRID CLASS - - -

//grid constructor 

function grid(n_cols, n_rows)
{
 this.tiles = new Array(n_cols);
 this.flip = new Array(n_cols);
 for(var i = 0; i < n_cols; i++)
 {
  this.tiles[i] = new Array(n_rows);
  this.flip[i] = new Array(n_rows);
 }
 this.n_cols = n_cols;
 this.n_rows = n_rows;
 
 for(var i = 0; i < n_cols; i ++)
 {
  for(var j = 0; j < n_rows; j ++)
  {
   sq = new tile(i, j);
   
   this.tiles[i][j] = sq;
   
   //this.tiles[i][j].draw();
  }
 }
}

//grid constructor *END*

grid.prototype.store = function(slotIndex)
{
 localStorage.setItem("Board"+slotIndex+"Cols", this.n_cols);
 localStorage.setItem("Board"+slotIndex+"Rows", this.n_rows);

 //var specialCount = 0;
 
 for(var i = 0; i < this.n_cols; i ++)
 {
  for(var j = 0; j < this.n_rows; j ++)
  {
   //console.log("Saving tile at (" + i + ", " + j + ") : TYPE=" + this.tiles[i][[j].type);
   //console.log("Saving tile at ("+i+", "+j+")");
   //console.log("Saving type: " + this.tiles[i][j].type + "...");
   //if(this.type != 0)
   //{
    localStorage.setItem("Board"+slotIndex+"Tile"+i+"_"+j, this.tiles[i][j].type);
    
    
    /*
    localStorage.setItem(specialCount+"Board"+slotIndex+"Tile_x", i);
    localStorage.setItem(specialCount+"Board"+slotIndex+"Tile_y", j);
    localStorage.setItem(specialCount+"Board"+slotIndex+"Tile_type", this.tiles[i][j].type);
    
    specialCount ++;
    */
   //}
  }
 }
 
 //localStorage.setItem("Board"+slotIndex+"specials", specialCount);
 
 customSlots[slotIndex] = 1;
 
 localStorage.setItem("customLvls", JSON.stringify(customSlots));
 
}

grid.prototype.read = function(slotIndex)
{
 var success = true;
 
 slotsAvailable();
 
 if(customSlots[slotIndex] == 0)
 {
  alert("Level not found!");
  
  success = false;
 }
 else
 {
 
  console.log("Loading grid...");
  
  this.n_cols = Number(localStorage.getItem("Board"+slotIndex+"Cols"));
  this.n_rows = Number(localStorage.getItem("Board"+slotIndex+"Rows"));
  
  for(var i = 0; i < this.n_cols; i ++)
  {
   for(var j = 0; j < this.n_rows; j ++)
   {
    //console.log("Loading tile at ("+i+", "+j+")...");
    
    
    //alert("Tile " + i + ", " + j + " = "  + Number(localStorage.getItem("Board"+slotIndex+"Tile"+i+j)));
    this.tiles[i][j] = new tile(i, j, Number(localStorage.getItem("Board"+slotIndex+"Tile"+i+"_"+j)));
    
    if(this.tiles[i][j].type == 2)
    {
     playerPos[0] = i;
     playerPos[1] = j;
    }
    //console.log("Tile type is " + this.type);
    
   }
  
  }
  /*
  var specials = localStorage.getItem("Board"+slotIndex+"specials");
  for(var i = 0; i < specials; i ++)
  {
   var _x = Number(localStorage.getItem(specials+"Board"+slotIndex+"Tile_x"));
   var _y = Number(localStorage.getItem(specials+"Board"+slotIndex+"Tile_y"));
   var _Type = Number(localStorage.getItem(specials+"Board"+slotIndex+"Tile_type"));
   
   console.log("Type: " + _Type);
   
   if(_Type == 2)
   {
    playerPos[0] = _x;
    playerPos[1] = _y;
   }
   
   this.tiles[_x][_y] = new tile(_x, _y, _Type);
   
  }*/
  
  
  
 }
 
 return success;


}

grid.prototype.copy = function (otherGrid)
{
 //alert("Type of otherGrid: " + typeof(otherGrid));

 if(testMode)
 {
  playerPos[0] = editMode.Conway_x;
  playerPos[1] = editMode.Conway_y;
 }
 
 for(var i = 0; i < this.n_cols; i ++)
 {
  for(var j = 0; j < this.n_rows; j ++)
  {
   this.tiles[i][j] = new tile(i, j, otherGrid.tiles[i][j].type);
   
  }
 }

}

grid.prototype.addTarget = function(bTarget, sTarget, gTarget)
{
 this.bTarget = bTarget;
 this.sTarget = sTarget;
 this.gTarget = gTarget;
}

grid.prototype.getBTarget = function()
{
 return this.bTarget;
}

grid.prototype.getSTarget = function()
{
 return this.sTarget;
}

grid.prototype.getGTarget = function()
{
 return this.gTarget;
}

grid.prototype.clear = function()
{
 for(var i = 0; i < this.n_cols; i ++)
 {
  for(var j = 0; j < this.n_rows; j ++)
  {
   sq = new tile(i, j);
   this.tiles[i][j] = sq;
  }
 
 }
}

grid.prototype.addLife = function(x_pos, y_pos)
{
 this.tiles[x_pos][y_pos].addLife();
}

grid.prototype.addPlayer = function()
{
 this.tiles[playerPos[0]][playerPos[1]].addPlayer();
}

grid.prototype.saveBlips = function(x_pos, y_pos)
{  
 
 
 if(x_pos+1 < 48)
 {
  if(this.tiles[x_pos+1][y_pos].getType() == 1)
  {
   safe ++;
   this.tiles[x_pos+1][y_pos].kill();
   this.flip[x_pos+1][y_pos] = false;
   Menu();
  }
 }
 if(x_pos-1 >= 0)
 {
  if(this.tiles[x_pos-1][y_pos].getType() == 1)
  {
   safe ++;
   this.tiles[x_pos-1][y_pos].kill();
   this.flip[x_pos-1][y_pos] = false;
   Menu();
  }
 }
 if(y_pos+1 < 30)
 {
  if(this.tiles[x_pos][y_pos+1].getType() == 1)
  {
   safe ++;
   this.tiles[x_pos][y_pos+1].kill();
   this.flip[x_pos][y_pos+1] = false;
   Menu();
  }
 }
 if(y_pos-1 >= 0)
 {
  if(this.tiles[x_pos][y_pos-1].getType() == 1)
  {
   safe ++;
   this.tiles[x_pos][y_pos-1].kill();
   this.flip[x_pos][y_pos-1] = false;
   Menu();
  }
 }
 
 
 if(safe >= this.bTarget)
 {
  if(!testMode)
  {  
   finishOn = true;
  } 
  
  if(Bounded(safe, this.bTarget-1, this.sTarget) == true)
  {
   //VCS
   // VICTORY CONDITIONS SATISFIED
   /*gameOn = false;
   Go = false;
   VictoryOn = true;
   Menu();   */
   if(trophy == 'n')
   {
    trophy = 'b';
   }
   //LevelSelect();
  }
  else if(Bounded(safe, this.sTarget-1, this.gTarget) == true)
  {
   if(trophy == 'n' || trophy == 'b')
   {
    trophy = 's';
   }
  }
  else if(safe >= this.gTarget)
  {
   if(testMode)
   {
    finishOn = true;
   }
  
   if(trophy != 'g')
   {
    trophy = 'g';
   }
  }
  Menu();
 }
 
 
}

grid.prototype.countNeighbours = function(x_pos, y_pos)
{
 var count = 0;
 
 for(var i = -1; i < 2; i ++)
 {
  for(var j = -1; j < 2; j ++)
  {
   if((i != 0 || j != 0) && (x_pos+i > -1 && x_pos+i < this.n_cols) && (y_pos+j > -1 && y_pos+j < this.n_rows))
   {
    if(this.tiles[x_pos+i][y_pos+j].getType() > 0)
    {
     count ++;
    }
   }
  }
 }
 return count;
}

grid.prototype.cycle = function(x_pos, y_pos)
{

 for(var i = 0; i < this.n_cols; i ++)
 { 
  for(var j = 0; j < this.n_rows; j ++)
  {
   var Neighbours = this.countNeighbours(i, j);
   
   if(this.tiles[i][j].alive() == true)
   {
   /*
    if(this.tiles[i][j].getType() == 3)
    {
     if(this.tiles[i][j].hasDir() == true && this.tiles[i][j].bulletMoved() == false)
     {
      this.moveBullet(i, j);
     }
    }
    else */ if(this.tiles[i][j].getType() != 3)
    {
     if(Neighbours == 2 || Neighbours == 3)
     {
      this.flip[i][j] = false;
     }
     else 
     {
      this.flip[i][j] = true;
     }
    }
   

    
   }
   else if(this.tiles[i][j].alive() == false)
   {
   
   
    if(Neighbours == 3)
    {
     this.flip[i][j] = true;
    }
    else
    {
     this.flip[i][j] = false;
    }
   /* 
    if(this.tiles[i][j].getType() == -2)
    {
     this.saveBlips(i, j);
    }
       
    if(this.tiles[i][j].getType() == -3 || this.tiles[i][j].getType() == -5)
    {
     this.turretAction(i, j);
    }
    
    if(this.tiles[i][j].getType() == -4)
    {
     if(this.tiles[i][j].hasDir() == true && this.tiles[i][j].bulletMoved() == false)
     {
      this.moveBullet(i, j);
     }
    }
   */
   }
  }
 }
 
 for(var i = 0; i < this.n_cols; i ++)
 {
  for(var j = 0; j < this.n_rows; j ++)
  {
   var Neighbours = this.countNeighbours(i, j);
   
   if(this.tiles[i][j].alive() == true)
   {
   
    if(this.tiles[i][j].getType() == 3)
    {
     if(this.tiles[i][j].hasDir() == true && this.tiles[i][j].bulletMoved() == false)
     {
      this.moveBullet(i, j);
     }
    }
   // else*/if(this.tiles[i][j].getType() != 3)
   /* {
     if(Neighbours == 2 || Neighbours == 3)
     {
      this.flip[i][j] = false;
     }
     else 
     {
      this.flip[i][j] = true;
     }
    }
   */

    
   }
   else if(this.tiles[i][j].alive() == false)
   {
   
   /*
    if(Neighbours == 3)
    {
     this.flip[i][j] = true;
    }
    else
    {
     this.flip[i][j] = false;
    }
   */
    if(this.tiles[i][j].getType() == -2)
    {
     this.saveBlips(i, j);
    }
    
    if(this.tiles[i][j].getType() == -3 || this.tiles[i][j].getType() == -5)
    {
     this.turretAction(i, j);
    }
    
    if(this.tiles[i][j].getType() == -4)
    {
     if(this.tiles[i][j].hasDir() == true && this.tiles[i][j].bulletMoved() == false)
     {
      this.moveBullet(i, j);
     }
    
    }
   
   }
  }
 }
}

// - - - REGULAR TURRETS - - -

grid.prototype.turretAction = function(x, y)
{
 var stage = this.tiles[x][y].getCount();
 var BioTur = false;
 
 if(this.tiles[x][y].getType() == -5)
 {
  BioTur = true;
 }

 
 if(stage == 30 && x-1 >= 0)  // - - - LOAD TURRET - - -
 {
  if(BioTur == false)
  {
   this.tiles[x-1][y].addBullet('none', 0);
  }
  else
  {
   this.tiles[x-1][y].addBio('none', 0);
  }
  
  this.tiles[x-1][y].fireBullet('none', 0);
  
  //alert("bullet created at " + (x-1) + ", " + y);
  
 }
 else if(stage == 20 && y-1 >= 0)
 {
  if(BioTur == false)
  {
  
   this.tiles[x][y-1].addBullet('none', 0);
  }
  else
  {
   this.tiles[x][y-1].addBio('none', 0);
  }
  this.tiles[x][y-1].fireBullet('none', 0);
  //alert("bullet created at " + x + ", " + (y-1));
 }
 else if(stage == 10 && x+1 < 48)
 {
  //alert((x+1));
 
  if(BioTur == false)
  {
   this.tiles[x+1][y].addBullet('none', 0);
  }
  else
  {
   this.tiles[x+1][y].addBio('none', 0);
  }
  this.tiles[x+1][y].fireBullet('none', 0);
  
  //alert("bullet created at " + (x+1) + ", " + y);
 }
 else if(stage == 0 && y+1 < 30)
 {
  if(BioTur == false)
  {
   this.tiles[x][y+1].addBullet('none', 0);
  }
  else
  {
   this.tiles[x][y+1].addBio('none', 0);
  }
  
  this.tiles[x][y+1].fireBullet('none', 0);
  //alert("bullet created at " + x + ", " + (y+1));
 }
 
 else if(stage == 25 && x-1 >= 0) // - - - FIRE BULLET - - -
 {
  this.tiles[x-1][y].fireBullet('x', -1);
  //alert("bullet at " + (x-1) + ", " + y + " fired");
 }
 else if(stage == 15 && y-1 >= 0)
 {
  this.tiles[x][y-1].fireBullet('y', -1);
  //alert("bullet at " + x + ", " + (y-1) + " fired");
 }
 else if(stage == 5 && x+1 < 48)
 {
  this.tiles[x+1][y].fireBullet('x', 1);
  //alert("bullet at " + (x+1) + ", " + y + " fired");
 }
 else if(stage == 35 && y+1 < 30)
 {
  this.tiles[x][y+1].fireBullet('y', 1);
  //alert("bullet at " + x + ", " + (y+1) + " fired");
 }
 
 this.tiles[x][y].doCount();  
}

grid.prototype.moveBullet = function(x_pos, y_pos)
{
 var dir = 'none';
 var mag = 0;
 var Bio = false
 
 if(this.tiles[x_pos][y_pos].getType() == 3)
 {
  Bio = true;
 }
 
 
 dx = this.tiles[x_pos][y_pos].x_vel;
 dy = this.tiles[x_pos][y_pos].y_vel;
 
 if(dx != 0)
 {
  dir = 'x';
  mag = dx; 
 }
 else if(dy != 0)
 {
  dir = 'y';
  mag = dy;
 }
 
 if(dir != 'none')
 {
  this.tiles[x_pos][y_pos].kill();
 }
 /*if(x_pos+dx >= 0 && y_pos+dy >= 0)
 {
  this.tiles[x_pos+dx][y_pos+dy].addBullet(dir, mag);
 }*/
 if(dir == 'x')
 {
  if(x_pos+mag >= 0 && x_pos+mag <= 47)
  {
   if(this.tiles[x_pos+mag][y_pos].getType() == 0)
   {
    if(Bio == false)
    {
     this.tiles[x_pos+mag][y_pos].addBullet(dir, mag, true);
    }
    else
    {
     this.tiles[x_pos+mag][y_pos].addBio(dir, mag, true);
    }
   }
   else if(this.tiles[x_pos+mag][y_pos].getType() == 1)
   {
    this.tiles[x_pos+mag][y_pos].kill();
   }
  }
 }
 else if(dir == 'y')
 {
  if(y_pos+mag >= 0 && y_pos+mag <= 29)
  {
   if(this.tiles[x_pos][y_pos+mag].getType() == 0)
   { 
    if(Bio == false)
    {
     this.tiles[x_pos][y_pos+mag].addBullet(dir, mag, true);
    }
    else
    {
     this.tiles[x_pos][y_pos+mag].addBio(dir, mag, true);
    }
   }
   else if(this.tiles[x_pos][y_pos+mag].getType() == 1)
   {
    this.tiles[x_pos][y_pos+mag].kill();
   }
  }  
 }
}

// - - - REGULAR TURRET * END * - - -

grid.prototype.doFlip = function()
{
 for(var i = 0; i < this.n_cols; i ++)
 {
  for(var j = 0; j < this.n_rows; j ++)
  {
   if(this.flip[i][j] == true)
   {
    this.tiles[i][j].flip();
   }
  }
 }
}

grid.prototype.addWall = function(x_start, y_start, len, dir)
{
 //alert("Type of len = "  +typeof(len));
 //alert("Type of dir = " + typeof(dir));

 if(typeof(len) ==="undefined") len = 1;
 if(typeof(dir) ==="undefined") dir = 'x';

 if(dir == 'x')
 {
  
  for( var i = 0; i < len; i++)
  {
   //alert("add wall...");
   this.tiles[x_start+i][y_start].addWall();
  }
  
  //alert("horizontal wall");
 }
 else if(dir == 'y')
 {
  
  for( var i = 0; i < len; i++)
  {
   this.tiles[x_start][y_start+i].addWall();
  }
  
  //alert("vertical wall");
 }
 else
 {
  //alert("wall error");
 }
}

grid.prototype.addPool = function(x_pos, y_pos)
{
 for(var i = -1; i < 2; i ++)
 {
  for(j = -1; j < 2; j ++)
  {
   if(i != 0 || j != 0)
   {
    this.tiles[x_pos+i][y_pos+j].addPool();
   }
  }
 }
}

grid.prototype.addTurret = function(x_pos, y_pos)
{
 this.tiles[x_pos][y_pos].addTurret();
}

grid.prototype.addBioTurret = function(x_pos, y_pos)
{
 this.tiles[x_pos][y_pos].addBioTurret();
}

grid.prototype.moveFrom = function()
{
 this.tiles[playerPos[0]][playerPos[1]].kill();
}

grid.prototype.moveTo = function()
{
 this.tiles[playerPos[0]][playerPos[1]].addPlayer();
}

grid.prototype.draw = function()
{
 for(var i = 0; i < this.n_cols; i ++)
 {
  for(var j = 0; j < this.n_rows; j ++)
  {
   this.tiles[i][j].draw();
  }
 }
}

// - - - GRID CLASS *END* - - -

function slotsAvailable()
{
 var storedLevels = localStorage.getItem("customLvls");
 
 for(var i = 0; i < 9; i ++)
 {
  if(storedLevels[1+i*2] == '0')
  {
   customSlots[i] = 0;
  }
  else
  {
   customSlots[i] = 1;
  }
 
 }

}

function gameLoop()
{ 
 gameBoard.cycle();
 gameBoard.doFlip();
 gameBoard.draw(); 
 
 if(VictoryOn == true)
 {
  victoryScreen();
 }
 if(canSave)
 {
  saveLevel();
 }
}

function clearScreen()
{
 ctx.fillStyle = "white";
 ctx.fillRect(0, 0, 720, 510);
}

function clearMenu()
{ 
 ctx.fillStyle= "white";
 ctx.fillRect(0, 451, 720, 60);
}

function countPoints()
{
 var CountPoints = 0;

 for(var  i = 0; i < 9; i ++)
 {
  if(trophies[i] == 'b')
  {
   CountPoints += 1;
  }
  else if(trophies[i] == 's')
  {
   CountPoints += 3;
  }
  else if(trophies[i] == 'g')
  {
   CountPoints += 5;
  }
  
 }
 
 return CountPoints;
}

function Menu()
{
 
 clearMenu();
 ctx.font = "30px Verdana";
 ctx.fillStyle = "black";
 if(Go == false)
 {
  ctx.fillText("PAUSED", 300, 492);
  //ctx.fillText("Back", 620, 490);
 }
 else
 {
  //ctx.fillText("Stop!", 320, 490);
  ctx.fillText("Safe: ", 20, 492);
  ctx.fillText(safe, 105, 492);
  ctx.fillText("/", 165, 492);
  if(safe < gameBoard.bTarget && testMode == false)
  {
   ctx.fillText(gameBoard.bTarget, 180, 492);
   
  }
  else if(Bounded(safe, gameBoard.bTarget-1, gameBoard.sTarget) == true && testMode == false)
  {
   ctx.fillText(gameBoard.sTarget, 180, 492);
  }
  else
  {
   ctx.fillText(gameBoard.gTarget, 180, 492);
  }
  if(!testMode)
  {
   if(trophy == 'b' || trophy == 's' || trophy == 'g')
   {
    lineWidth = "1";
    ctx.beginPath();
    ctx.arc(270, 480, 10, 0, 2*Math.PI);
    ctx.fillStyle = 'brown';
    ctx.fill();
    ctx.stroke();
   }
   if(trophy == 's' || trophy == 'g')
   {
    lineWidth = "1";
    ctx.beginPath();
    ctx.arc(300, 480, 10, 0, 2*Math.PI);
    ctx.fillStyle = "grey";
    ctx.fill();
    ctx.stroke();
   }
   if(trophy == 'g')
   {
    lineWidth = "1";
    ctx.beginPath();
    ctx.arc(330, 480, 10, 0, 2*Math.PI);
    ctx.fillStyle = "yellow";
    ctx.fill();
    ctx.stroke();
   }
  }
  
  
  
  if(finishOn == true)
  {
   ctx.beginPath();
   ctx.lineWidth = "2";
   ctx.rect(360, 451, 120, 60);
   ctx.stroke();
   ctx.fillStyle = "black";
   ctx.fillText("Finish!", 371, 492);
  }
  
  ctx.font = "20px Trebuchet MS";
  ctx.fillStyle = "black";
  
  if(!testMode)
  {
   ctx.fillText("Level", 635, 475);
   ctx.fillText("Select", 633, 500);
  }
  else
  {
   ctx.fillText("Main", 637, 475);
   ctx.fillText("Menu", 637, 500);
  }
  
  ctx.fillText("Reset", 515, 490);
  
  ctx.beginPath();
  ctx.lineWidth = "2";
  ctx.rect(480, 451, 120, 60);
  ctx.stroke();
  
  ctx.beginPath();
  ctx.lineWidth = "2";
  ctx.rect(601, 451, 120, 60);
  ctx.stroke();
 }
}

// * * * TITLE * * *
// * * * ----- * * *

function titleScreen()
{
 safe = 0;
 finishOn = false;
 
 var loadTrophies = localStorage.getItem("trophies");
 loadTrophies = JSON.parse(loadTrophies);
 
 
 
 
 for(var i = 0; i < 18; i ++)
 {
  trophies[i] = loadTrophies[i];
 }
 totalPoints = countPoints();
 
 
 TitleScreen = true;

 clearScreen();
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 ctx.fillText("Blip Shepherd", 265, 225);
 
 ctx.fillStyle = "black";
 ctx.fillRect(120, 300, 120, 30);
 ctx.fillRect(480, 300, 120, 30);
 ctx.fillRect(300, 400, 120, 30);
 
 ctx.font = "16px Trebuchet MS";
 ctx.fillText("a game by Josh Haxell", 550, 500);
 ctx.fillText("Director's Cut", 380, 250);
 
 
 ctx.fillStyle = "white";
 ctx.font = "20px Trebuchet MS";
 ctx.fillText("Start", 155, 322);
 ctx.fillText("Instructions", 486, 322); 
 ctx.fillText("Level Editor", 305, 422);
 
 
}

// * * * ----- * * *


// * * * LEVEL SELECT * * *
// * * * ------------ * * *
/*
function unlock()
{
 if(totalScore >= 0)
 {
  locked[0] = false;
 }
 if(totalScore >= 1)
 {
  locked[1] = false;
 }
 if(totalScore >= 2)
 {
  locked[2] = false;
 }
}
*/
function levelSelect()
{
 //unlock();
 totalPoints = countPoints();
 LevelSel = true;
 gameBoard.clear();
 clearScreen();
 
 ctx.font = "30px Trebuchet MS";
 
 for(var row = 0; row < 3; row ++)
 { 
  for(var col = 0; col < 3; col ++)
  {
   
   ctx.font = "30px Trebuchet MS";
   
   ctx.beginPath();
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.stroke();
   
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.stroke();
   
   ctx.fillStyle = "black";
   ctx.fillText( (1+row*3+col) , 167+2*90*col, 120+2*60*row);
   
   
   if(totalPoints >= unlockThresh[row*3+col])
   {
    if(trophies[row*3+col] == 'b' || trophies[row*3+col] == 's' || trophies[row*3+col] == 'g')
    {
     ctx.beginPath();
     ctx.arc(145+2*90*col, 155+2*60*row, 5, 0, 2*Math.PI);
     ctx.fillStyle = "brown";
     ctx.stroke();
     ctx.fill();
    }
    if(trophies[row*3+col] == 's' || trophies[row*3+col] == 'g')
    {
     ctx.beginPath();
     ctx.arc(175+2*90*col, 155+2*60*row, 5, 0, 2*Math.PI);
     ctx.fillStyle = "grey";
     ctx.stroke();
     ctx.fill();
    }
    if(trophies[row*3+col] == 'g')
    {
     ctx.beginPath();
     ctx.arc(205+2*90*col, 155+2*60*row, 5, 0, 2*Math.PI);
     ctx.fillStyle = "yellow";
     ctx.stroke();
     ctx.fill();
    }
   }
   else
   {
    ctx.font = "16px Trebuchet MS";
    ctx.fillText("Locked!", 147+2*90*col, 135+2*60*row);
    ctx.fillText(unlockThresh[row*3+col] + " points", 143+2*90*col, 160+2*60*row);
   }
  }
 } 
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 ctx.fillText("Custom Levels", 20, 490);
 ctx.fillText("Bonus Levels", 515, 490);
 ctx.fillText("Level Select", 275, 40);
 ctx.fillText("Main Menu", 285, 490);
 
 for(var i = 0; i < 3; i ++)
 {
  ctx.beginPath();
  ctx.lineWidth = "4";
  ctx.rect(i*240, 450, 240, 60);
  ctx.stroke();
 }
 
 ctx.font = "16px Trebuchet MS";
 ctx.fillText("Total points: " + totalPoints, 300, 60);
 
}

// * * * --------- * * *

function CustomLevels()
{
 //totalPoints = countPoints();
 customLevels = true;
 gameBoard.clear();
 clearScreen();
 
 slotsAvailable();
 
 ctx.font = "30px Trebuchet MS";
 
 for(var row = 0; row < 3; row ++)
 { 
  for(var col = 0; col < 3; col ++)
  {
   
   ctx.font = "30px Trebuchet MS";
   
   ctx.beginPath();
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.stroke();
   
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.stroke();
   
   ctx.fillStyle = "black";
   ctx.fillText( (1+row*3+col) , 167+2*90*col, 120+2*60*row);
   
   if(customSlots[row*3+col] == 0)
   {
    ctx.font = "16px Trebuchet MS";
    //alert("Slot " + (row*3+col));
    ctx.fillStyle = "black";
    ctx.fillText("EMPTY", 150+180*col, 162+120*row);
   
   }
   
  }
 } 
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 //ctx.fillText("Custom Levels", 20, 490);
 //ctx.fillText("Bonus Levels", 515, 490);
 ctx.fillText("Custom Levels", 275, 40);
 ctx.fillText("Level Select", 285, 490);
 
 for(var i = 0; i < 3; i ++)
 {
  ctx.beginPath();
  ctx.lineWidth = "4";
  ctx.rect(i*240, 450, 240, 60);
  ctx.stroke();
 }
 /*
 ctx.font = "16px Trebuchet MS";
 ctx.fillText("Total points: " + totalPoints, 300, 60);
 */

}


// * * * --------- * * *


function BonusLevels()
{
 //totalPoints = countPoints();
 //countPoints();
 bonusLevels = true;
 gameBoard.clear();
 clearScreen();
 
 ctx.font = "30px Trebuchet MS";
 
 for(var row = 0; row < 3; row ++)
 { 
  for(var col = 0; col < 3; col ++)
  {
   
   ctx.font = "30px Trebuchet MS";
   
   ctx.beginPath();
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.stroke();
   
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.stroke();
   
   ctx.fillStyle = "black";
   ctx.fillText( (1+row*3+col) , 167+2*90*col, 120+2*60*row);
   
   if(trophies[9+row*3+col] == 'b' || trophies[9+row*3+col] == 's' || trophies[9+row*3+col] == 'g')
   {
   
    ctx.beginPath();
    ctx.arc(145+2*90*col, 155+2*60*row, 5, 0, 2*Math.PI);
    ctx.fillStyle = "brown";
    ctx.stroke();
    ctx.fill();
   }
   if(trophies[9+row*3+col] == 's' || trophies[9+row*3+col] == 'g')
   {
    ctx.beginPath();
    ctx.arc(175+2*90*col, 155+2*60*row, 5, 0, 2*Math.PI);
    ctx.fillStyle = "grey";
    ctx.stroke();
    ctx.fill();
   }
   if(trophies[9+row*3+col] == 'g')
   {
    ctx.beginPath();
    ctx.arc(205+2*90*col, 155+2*60*row, 5, 0, 2*Math.PI);
    ctx.fillStyle = "yellow";
    ctx.stroke();
    ctx.fill();
   }
   
  
  }
 } 
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 //ctx.fillText("Custom Levels", 20, 490);
 //ctx.fillText("Bonus Levels", 515, 490);
 ctx.fillText("Bonus Levels", 275, 40);
 ctx.fillText("Level Select", 285, 490);
 
 for(var i = 0; i < 3; i ++)
 {
  ctx.beginPath();
  ctx.lineWidth = "4";
  ctx.rect(i*240, 450, 240, 60);
  ctx.stroke();
 }
 /*
 ctx.font = "16px Trebuchet MS";
 ctx.fillText("Total points: " + totalPoints, 300, 60);
 */


}



function EditorMenu()
{
 clearMenu();
 ctx.font = "30px Verdana";
 ctx.fillStyle = "black";

 if(finishOn == true)
 {
  ctx.beginPath();
  ctx.lineWidth = "2";
  ctx.rect(360, 451, 120, 60);
  ctx.stroke();
  ctx.fillStyle = "black";
  ctx.fillText("Finish!", 371, 492);
 }
  
 ctx.font = "20px Trebuchet MS";
 ctx.fillStyle = "black";
  
  
 ctx.fillText("Quit", 670, 490);
 //ctx.fillText("Select", 633, 500);
 ctx.fillText("Clear", 606, 490);
 ctx.fillText("Test", 550, 490);
 
 
 ctx.beginPath();
 ctx.lineWidth = "2";
 ctx.rect(660, 451, 60, 60);
 ctx.stroke();
  
 ctx.beginPath();
 ctx.lineWidth = "2";
 ctx.rect(600, 451, 60, 60);
 ctx.stroke();

 ctx.beginPath();
 ctx.lineWidth = "2";
 ctx.rect(540, 451, 60, 60);
 ctx.stroke();
 
 for(var i = 0; i < 6; i ++)
 {
  
 
  ctx.beginPath();
  ctx.lineWidth = "2";
  ctx.rect(90*i, 451, 90, 60);
  ctx.stroke();
  
  if(i == editMode.placeSelection)
  {
   ctx.fillRect(90*i, 451, 90, 10);
  }
 
 }
 
 ctx.beginPath();
 ctx.lineWidth = "0.75";
 ctx.strokeStyle = "black";
 ctx.rect(38, 480, 15, 15);
 ctx.fillStyle = "green";
 ctx.fillRect(38, 480, 15, 15);
 ctx.stroke();
   
 ctx.beginPath();
 ctx.lineWidth = "0.75";
 ctx.strokeStyle = "black";
 ctx.rect(128, 480, 15, 15);
 ctx.fillStyle = "yellow";
 ctx.fillRect(128, 480, 15, 15);
 ctx.stroke();
   
 ctx.beginPath();
 ctx.lineWidth = "0.75";
 ctx.strokeStyle = "black";
 ctx.rect(218, 480, 15, 15);
 ctx.fillStyle = "black";
 ctx.fillRect(218, 480, 15, 15);
 ctx.stroke();
 
 ctx.beginPath();
 ctx.lineWidth = "0.75";
 ctx.strokeStyle = "black";
 ctx.rect(308, 480, 15, 15);
 ctx.fillStyle = "brown";
 ctx.fillRect(308, 480, 15, 15);
 ctx.stroke();
 
 ctx.beginPath();
 ctx.lineWidth = "0.75";
 ctx.strokeStyle = "black";
 ctx.rect(398, 480, 15, 15);
 ctx.fillStyle = "mediumvioletred";
 ctx.fillRect(398, 480, 15, 15);
 ctx.stroke();
 
 
 
 for(var i = 0; i < 3; i ++)
 {
  for(var j = 0; j < 3; j ++)
  {
   if(i != 1 || j != 1)
   {
    ctx.beginPath();
    ctx.lineWidth = "0.75";
    ctx.strokeStyle = "black";
    ctx.rect(473+i*15, 465+j*15, 15, 15);
    ctx.fillStyle = "blue";
    ctx.fillRect(473+i*15, 465+j*15, 15, 15);
    ctx.stroke();
   }
  }
 }
 
 
}

// * * * --------- * * *

function LevelEdit()
{
 Editor = true;
 gameBoard.draw();
 EditorMenu();


}


// * * * --------- * * *

function playLevel(LEVEL_TYPE)
{
 //alert(typeof(LEVEL_TYPE));
 
 if(typeof(LEVEL_TYPE) == "undefined") LEVEL_TYPE = "NORMAL";
 
 
 lvlType = LEVEL_TYPE;
 safe = 0;
 trophy = 'n';
 finishOn = false;
 
 if(LEVEL_TYPE == "NORMAL")
 {
 
  //alert("Normal level");
  if(!testMode)
  {
   switch(level)
   {
    case 1:
    {
     playerPos[0] = 7;
     playerPos[1] = 8;
     gameBoard.addWall(5, 4, 22, 'x');
     gameBoard.addWall(5, 12, 22, 'x');
     gameBoard.addWall(26, 5, 7, 'y');
     gameBoard.addWall(5, 5, 7, 'y');
     gameBoard.addLife(13, 6);
     gameBoard.addLife(14, 6);
     gameBoard.addLife(15, 6);
     gameBoard.addLife(13, 10);
     gameBoard.addLife(14, 10);
     gameBoard.addLife(15, 10);
     gameBoard.addPool(23, 8);
     gameBoard.addTarget(25, 50, 100);
    
    break;
    }
    case 2:
    {
     playerPos[0] = 2;
     playerPos[1] = 4;
     
     gameBoard.addWall(0, 10, 42, 'x');
     gameBoard.addWall(45, 10, 3, 'x');
     gameBoard.addWall(6, 20, 42, 'x');
     gameBoard.addWall(0, 2, 5, 'y');
     gameBoard.addWall(4, 2, 2, 'y');
     gameBoard.addWall(4, 5, 2, 'y');
     gameBoard.addWall(5, 3, 6, 'x');
     gameBoard.addWall(5, 5, 6, 'x');
     gameBoard.addWall(1, 2, 3, 'x');
     gameBoard.addWall(1, 6, 3, 'x');
     gameBoard.addWall(14, 3, 3, 'y');
     gameBoard.addWall(10, 0, 3, 'y');
     gameBoard.addWall(10, 6, 3, 'y');
     gameBoard.addWall(11, 0, 37, 'x');
     gameBoard.addWall(11, 8, 31, 'x');
     gameBoard.addWall(45, 8, 3, 'x');
     gameBoard.addWall(15, 4, 13, 'x');
     gameBoard.addWall(17, 1, 2, 'y');
     gameBoard.addWall(19, 2, 2, 'y');
     gameBoard.addWall(21, 1, 2, 'y');
     gameBoard.addWall(23, 2, 2, 'y');
     gameBoard.addWall(25, 1, 2, 'y');
     gameBoard.addWall(27, 2, 2, 'y');
     gameBoard.addWall(45, 9, 1, 'y');
     gameBoard.addWall(41, 9, 1, 'y');
     gameBoard.addWall(17, 6, 2, 'y');
     gameBoard.addWall(19, 5, 2, 'y');
     gameBoard.addWall(21, 6, 2, 'y');
     gameBoard.addWall(23, 5, 2, 'y');
     gameBoard.addWall(25, 6, 2, 'y');
     gameBoard.addWall(27, 5, 2, 'y');
     gameBoard.addWall(28, 6, 12, 'x');
     gameBoard.addWall(29, 1, 4, 'y'); 
     gameBoard.addWall(31, 2, 4, 'y'); 
     gameBoard.addWall(33, 1, 4, 'y'); 
     gameBoard.addWall(35, 2, 4, 'y');
     gameBoard.addWall(37, 1, 4, 'y'); 
     gameBoard.addWall(39, 2, 4, 'y');
     gameBoard.addWall(41, 2, 6, 'y');
     gameBoard.addWall(42, 2, 5, 'x');
     gameBoard.addWall(46, 3, 4, 'y');
     gameBoard.addWall(44, 4, 5, 'y');
     gameBoard.addWall(43, 4, 1, 'x');
     
     
     for(var i = 1; i < 4; i ++)
     {
      gameBoard.addLife(12*i, 14);
      gameBoard.addLife(12*i, 15);
      gameBoard.addLife(12*i, 16);
     }
     
     gameBoard.addTurret(2, 15);
     gameBoard.addTurret(12, 22);
     gameBoard.addTurret(24, 28);
     gameBoard.addPool(45, 25);
     gameBoard.addTarget(25, 50, 100);
     
     
    break;
    }
    case 3:
    {
     playerPos[0] = 2;
     playerPos[1] = 2;
     
     gameBoard.addBioTurret(12, 10);
     gameBoard.addBioTurret(24, 10);
     gameBoard.addBioTurret(36, 10);
     
     gameBoard.addBioTurret(12, 20);
     gameBoard.addBioTurret(24, 20);
     gameBoard.addBioTurret(36, 20);
     
     gameBoard.addWall(0, 0, 12, 'x');
     gameBoard.addWall(1, 9, 4, 'x');
     gameBoard.addWall(7, 9, 5, 'x'); 
     gameBoard.addWall(11, 6, 3, 'y');
     gameBoard.addWall(0, 1, 9, 'y');
     gameBoard.addWall(11, 1, 3, 'y');
     
     gameBoard.addLife(5, 4);
     gameBoard.addLife(6, 4);
     gameBoard.addLife(5, 5);
     gameBoard.addLife(6, 5);
     
     gameBoard.addPool(45, 27);
     
     gameBoard.addTarget(25, 50, 100);
     
    break;
    }
    case 4:
    {
     gameBoard.addWall(21, 1, 5, 'y');
     gameBoard.addWall(27, 1, 5, 'y');
     gameBoard.addWall(21, 0, 7, 'x');
     gameBoard.addWall(21, 10, 9, 'y');
     gameBoard.addWall(27, 10, 9, 'y');
     gameBoard.addWall(21, 23, 5, 'y');
     gameBoard.addWall(27, 23, 5, 'y');
     gameBoard.addWall(21, 28, 7, 'x');
    
     gameBoard.addWall(14, 10, 7, 'x');
     gameBoard.addWall(14, 18, 7, 'x');
     gameBoard.addWall(13, 10, 9, 'y');
   
     gameBoard.addWall(28, 10, 7, 'x');
     gameBoard.addWall(28, 18, 7, 'x');
     gameBoard.addWall(35, 10, 9, 'y');
      
     gameBoard.addWall(3, 6, 17, 'y');
     gameBoard.addWall(3, 5, 18, 'x');
     gameBoard.addWall(3, 23, 18, 'x');
     
     gameBoard.addWall(45, 6, 17, 'y');
     gameBoard.addWall(28, 5, 18, 'x');
     gameBoard.addWall(28, 23, 18, 'x');
     
     gameBoard.addBioTurret(23, 13);
     gameBoard.addBioTurret(23, 15);
     gameBoard.addBioTurret(25, 14);
     
     gameBoard.addTurret(28, 10);
     gameBoard.addTurret(30, 10);
     gameBoard.addTurret(32, 10);
     gameBoard.addTurret(34, 10);
     
     gameBoard.addTurret(29, 5);
     gameBoard.addTurret(31, 5);
     gameBoard.addTurret(33, 5);
     
     gameBoard.addTurret(28, 18);
     gameBoard.addTurret(30, 18);
     gameBoard.addTurret(32, 18);
     gameBoard.addTurret(34, 18);
     
     gameBoard.addTurret(29, 23);
     gameBoard.addTurret(31, 23);
     gameBoard.addTurret(33, 23);
     
     
     
     playerPos[0] = 8;
     playerPos[1] = 14;
     
     gameBoard.addPool(40, 14);
     gameBoard.addTarget(25, 50, 100);
     
    break;
    }
    case 5:
    {
     gameBoard.addWall(7, 14, 29, 'x');
     gameBoard.addWall(6, 12, 5, 'y');
     gameBoard.addWall(7, 12, 10, 'x');
     gameBoard.addWall(7, 16, 10, 'x'); 
     
     gameBoard.addWall(0, 7, 15, 'y');
     gameBoard.addWall(1, 7, 40, 'x'); 
     gameBoard.addWall(1, 21, 40, 'x');
     gameBoard.addWall(40, 8, 5, 'y');
     gameBoard.addWall(40, 16, 5, 'y');
     
     
     gameBoard.addWall(47, 13, 3, 'y'); 
     gameBoard.addWall(40, 13, 7, 'x');
     gameBoard.addWall(40, 15, 7, 'x');
     
     gameBoard.addWall(16, 11, 4, 'x');
     gameBoard.addWall(16, 17, 4, 'x');
     gameBoard.addWall(19, 12, 8, 'x');
     gameBoard.addWall(19, 16, 8, 'x');
     
     gameBoard.addWall(26, 11, 4, 'x');
     gameBoard.addWall(26, 17, 4, 'x');
     gameBoard.addWall(29, 12, 5, 'x');
     gameBoard.addWall(29, 16, 5, 'x');
     
     gameBoard.addLife(17, 12);
     gameBoard.addLife(18, 12);
     gameBoard.addLife(17, 13);
     gameBoard.addLife(18, 13);
     
     gameBoard.addLife(17, 15);
     gameBoard.addLife(17, 16);
     gameBoard.addLife(18, 15);
     gameBoard.addLife(18, 16);
     
     gameBoard.addLife(27, 12);
     gameBoard.addLife(27, 13);
     gameBoard.addLife(28, 12);
     gameBoard.addLife(28, 13);
     
     gameBoard.addLife(27, 15);
     gameBoard.addLife(27, 16);
     gameBoard.addLife(28, 15);
     gameBoard.addLife(28, 16);
     
     gameBoard.addBioTurret(7, 13);
     gameBoard.addBioTurret(7, 15);
     
     gameBoard.addPool(3, 14);
     
     playerPos[0] = 46;
     playerPos[1] = 14;
     
     gameBoard.addTarget(25, 50, 100);
     
    break;
    }
    case 6:
    {
     gameBoard.addWall(22, 0, 5, 'y');
     gameBoard.addWall(26, 0, 5, 'y');
     gameBoard.addWall(23, 0, 3, 'x');
     gameBoard.addWall(23, 4, 12, 'y');
     gameBoard.addWall(25, 4, 12, 'y');
     gameBoard.addWall(23, 17, 13, 'y');
     gameBoard.addWall(25, 17, 13, 'y');
     
     gameBoard.addWall(20, 4, 2, 'x'); 
     gameBoard.addWall(19, 4, 5, 'y');
     gameBoard.addWall(20, 8, 1, 'x');
     gameBoard.addWall(22, 8, 1, 'x');
     
     gameBoard.addWall(9, 8, 10, 'x');
     gameBoard.addWall(9, 24, 14, 'x');
     gameBoard.addWall(9, 9, 15, 'y');
     
     gameBoard.addWall(26, 12, 5, 'x');
     gameBoard.addWall(30, 13, 7, 'y');
     gameBoard.addWall(26, 20, 5, 'x');
     
     gameBoard.addLife(25, 16);
     gameBoard.addLife(26, 15);
     gameBoard.addLife(27, 15);
     gameBoard.addLife(27, 16);
     gameBoard.addLife(26, 17);
     
     playerPos[0] = 20;
     playerPos[1] = 16;
     
     gameBoard.addBioTurret(24, 2);
     gameBoard.addBioTurret(21, 6);
     
     gameBoard.addTarget(25, 50, 100);
     gameBoard.addPool(11, 16);
     
    break;
    }
    case 7:
    {
     gameBoard.addLife(1, 5);
     gameBoard.addLife(2, 5);
     gameBoard.addLife(1, 6);
     gameBoard.addLife(2, 6);
     
     gameBoard.addLife(11, 5);
     gameBoard.addLife(11, 6);
     gameBoard.addLife(11, 7);
     gameBoard.addLife(12, 4);
     gameBoard.addLife(12, 8);
     gameBoard.addLife(13, 3);
     gameBoard.addLife(13, 9);
     gameBoard.addLife(14, 3);
     gameBoard.addLife(14, 9);
     gameBoard.addLife(15, 6);
     gameBoard.addLife(16, 4);
     gameBoard.addLife(16, 8);
     gameBoard.addLife(17, 5);
     gameBoard.addLife(17, 6);
     gameBoard.addLife(17, 7);
     gameBoard.addLife(18, 6);
     
     gameBoard.addLife(21, 3);
     gameBoard.addLife(21, 4);
     gameBoard.addLife(21, 5);
     gameBoard.addLife(22, 3);
     gameBoard.addLife(22, 4);
     gameBoard.addLife(22, 5);
     gameBoard.addLife(23, 2);
     gameBoard.addLife(23, 6);
     gameBoard.addLife(25, 1);
     gameBoard.addLife(25, 2);
     gameBoard.addLife(25, 6);
     gameBoard.addLife(25, 7);
     
     gameBoard.addLife(35, 3);
     gameBoard.addLife(35, 4);
     gameBoard.addLife(36, 3);
     gameBoard.addLife(36, 4);
     
     gameBoard.addBioTurret(7, 22);
     gameBoard.addTurret(3, 26);
     gameBoard.addBioTurret(1, 28);
     
     gameBoard.addWall(5, 24, 2, 'x'); 
     gameBoard.addWall(5, 9, 13, 'y');
     gameBoard.addWall(0, 9, 5, 'x');
     gameBoard.addWall(42, 24, 6, 'x');
     gameBoard.addWall(8, 24, 26, 'x');
     gameBoard.addWall(6, 20, 3, 'x');
     gameBoard.addWall(9, 20, 4, 'y');
     gameBoard.addWall(5, 23, 1, 'y');
     
     gameBoard.addPool(2, 13);
     
     playerPos[0] = 2;
     playerPos[1] = 27;
     
     gameBoard.addTarget(25, 50, 100);
    break;
    }
    case 8:
    {
     gameBoard.addWall(10, 9, 36, 'x');
     gameBoard.addWall(10, 21, 36, 'x');
     gameBoard.addWall(10, 10, 11, 'y');
     gameBoard.addWall(37, 14, 3, 'y');
     gameBoard.addWall(38, 14, 3, 'y');
     gameBoard.addWall(39, 14, 3, 'y');
     gameBoard.addWall(40, 14, 3, 'y');
     gameBoard.addWall(41, 14, 3, 'y');
     gameBoard.addWall(42, 14, 3, 'y');
     gameBoard.addWall(45, 10, 11, 'y'); 
     
     gameBoard.addWall(22, 10, 5, 'y');
     gameBoard.addWall(22, 16, 5, 'y');
     gameBoard.addWall(23, 10, 4, 'y');
     gameBoard.addWall(23, 16, 5, 'y');
     gameBoard.addWall(24, 10, 4, 'y');
     gameBoard.addWall(24, 16, 5, 'y');
     gameBoard.addWall(25, 10, 5, 'y');
     gameBoard.addWall(25, 16, 5, 'y');
     
     gameBoard.addLife(23, 14);
     gameBoard.addLife(24, 14);
     gameBoard.addLife(23, 15);
     gameBoard.addLife(24, 15);
     
     gameBoard.addBioTurret(12, 15);
     gameBoard.addBioTurret(35, 15);
     playerPos[0] = 12;
     playerPos[1] = 11;
     
     gameBoard.addPool(43, 15);
     
     gameBoard.addTarget(25, 50, 100);
     
    break;
    }
    case 9:
    {
     playerPos[0] = 1;
     playerPos[1] = 1;
     gameBoard.addWall(6, 0, 10, 'y');
     gameBoard.addWall(14, 0, 14, 'y');
     gameBoard.addWall(3, 10, 4, 'y'); 
     gameBoard.addWall(0, 9, 4, 'x');
     gameBoard.addWall(3, 14, 12, 'x');
     gameBoard.addWall(7, 9, 5, 'x');
     gameBoard.addLife(3, 6);
     gameBoard.addLife(4, 6);
     gameBoard.addLife(5, 6);
     gameBoard.addPool(10, 2);
     
     gameBoard.addTarget(25, 50, 100);
     
    break;
    }
    case 15: // BONUS 6
    {
     //alert("loading bonus level...");
    
     playerPos[0] = 8;
     playerPos[1] = 11;
     
     //alert("player added...");
     
     // OUTER TURRETS
     
     gameBoard.addBioTurret(27, 18);
     gameBoard.addBioTurret(34, 11);
     gameBoard.addBioTurret(34, 25);
     gameBoard.addBioTurret(41, 18);
     
     //alert("outer turrets added...");
     
     // INNER TURRETS
     
     gameBoard.addBioTurret(33, 18);
     gameBoard.addBioTurret(34, 17);
     gameBoard.addBioTurret(34, 19);
     gameBoard.addBioTurret(35, 18);
     
     //alert("inner turret added...");
     
     // WALLS (TOP DOWN)
     
     gameBoard.addWall(34, 12);
     //alert("row_0 added");
     gameBoard.addWall(33, 13);
     gameBoard.addWall(35, 13);
     ///alert("row_1 added");
     gameBoard.addWall(32, 14);
     gameBoard.addWall(36, 14);
     //alert("row_2 added");
     gameBoard.addWall(31, 15);
     gameBoard.addWall(37, 15);
     //alert("row_3 added");
     gameBoard.addWall(30, 16);
     gameBoard.addWall(38, 16);
     //alert("row_4 added");
     gameBoard.addWall(29, 17);
     gameBoard.addWall(39, 17);
     //alert("row_5 added");
     gameBoard.addWall(28, 18);
     gameBoard.addWall(40, 18);
     //alert("row_6 added");
     gameBoard.addWall(29, 19);
     gameBoard.addWall(39, 19);
     //alert("row_7 added");
     gameBoard.addWall(30, 20);
     gameBoard.addWall(38, 20);
     //alert("row_8 added");
     gameBoard.addWall(31, 21);
     gameBoard.addWall(37, 21);
     //alert("row_9 added");
     gameBoard.addWall(32, 22);
     gameBoard.addWall(36, 22);
     //alert("row_10 added");
     gameBoard.addWall(33, 23);
     gameBoard.addWall(35, 23);
     //alert("row_11 added");
     gameBoard.addWall(34, 24);
     //alert("row_12 added");
     
     //alert("walls added...");
     
     gameBoard.addPool(44, 7);
     
     //alert("pool added...");
     
     gameBoard.addTarget(25, 50, 100);
    
    break;
    }
    
    case 11: // BONUS 2
    {
     playerPos[0] = 16;
     playerPos[1] = 28;
     
     // WALLS
     
     // ------
     //  LEFT
     // ------
     
     // WALLS
     gameBoard.addWall(13, 1);
     gameBoard.addWall(13, 3);
     gameBoard.addWall(13, 5);
     gameBoard.addWall(13, 7);
     gameBoard.addWall(13, 9);
     gameBoard.addWall(13, 11);
     gameBoard.addWall(13, 13);
     gameBoard.addWall(13, 15);
     gameBoard.addWall(13, 17);
     gameBoard.addWall(13, 19);
     gameBoard.addWall(13, 21);
     gameBoard.addWall(13, 23);
     gameBoard.addWall(13, 25);
     gameBoard.addWall(13, 27);
     gameBoard.addWall(13, 28);
     gameBoard.addWall(13, 29);
     
     // CLASSIC TURRETS
     gameBoard.addTurret(13, 0);
     gameBoard.addTurret(13, 2);
     gameBoard.addTurret(13, 4);
     gameBoard.addTurret(13, 6);
     gameBoard.addTurret(13, 8);
     gameBoard.addTurret(13, 10);
     gameBoard.addTurret(13, 12);
     gameBoard.addTurret(13, 14);
     gameBoard.addTurret(13, 16);
     gameBoard.addTurret(13, 18);
     
     
     // BIO TURRETS
     gameBoard.addBioTurret(13, 20);
     gameBoard.addBioTurret(13, 22);
     gameBoard.addBioTurret(13, 24);
     gameBoard.addBioTurret(13, 26);
     
     // ---------
     //  CENTRE
     // ---------
     
     // WALLS
     
     gameBoard.addWall(19, 6);
     gameBoard.addWall(19, 8);
     gameBoard.addWall(19, 10);
     gameBoard.addWall(19, 12);
     gameBoard.addWall(19, 14);
     gameBoard.addWall(19, 16);
     gameBoard.addWall(19, 18);
     gameBoard.addWall(19, 20);
     gameBoard.addWall(19, 22);
     gameBoard.addWall(19, 24);
     gameBoard.addWall(19, 26);
     gameBoard.addWall(19, 27);
     gameBoard.addWall(19, 28);
     gameBoard.addWall(19, 29);
     
     gameBoard.addWall(20, 18, 9, 'y');
     
     // CLASSIC TURRETS
     
     gameBoard.addTurret(19, 5);
     gameBoard.addTurret(19, 7);
     gameBoard.addTurret(19, 9);
     gameBoard.addTurret(19, 11);
     gameBoard.addTurret(19, 13);
     gameBoard.addTurret(19, 15);
     gameBoard.addTurret(19, 17);
     
     
     // BIO TURRETS
     
     gameBoard.addBioTurret(19, 19);
     gameBoard.addBioTurret(19, 21);
     gameBoard.addBioTurret(19, 23);
     gameBoard.addBioTurret(19, 25);
     
     
     // -------
     //  RIGHT 
     // -------
     
     // WALLS
     gameBoard.addWall(25, 1);
     gameBoard.addWall(25, 3);
     gameBoard.addWall(25, 5);
     gameBoard.addWall(25, 7);
     gameBoard.addWall(25, 9);
     gameBoard.addWall(25, 11);
     gameBoard.addWall(25, 13);
     gameBoard.addWall(25, 15);
     gameBoard.addWall(25, 17);
     gameBoard.addWall(25, 19);
     gameBoard.addWall(25, 21);
     gameBoard.addWall(25, 23);
     gameBoard.addWall(25, 25);
     gameBoard.addWall(25, 27);
     gameBoard.addWall(25, 28);
     gameBoard.addWall(25, 29);
     
     // CLASSIC TURRETS
     gameBoard.addTurret(25, 0);
     gameBoard.addTurret(25, 2);
     gameBoard.addTurret(25, 4);
     gameBoard.addTurret(25, 6);
     gameBoard.addTurret(25, 8);
     gameBoard.addTurret(25, 10);
     gameBoard.addTurret(25, 12);
     gameBoard.addTurret(25, 14);
     gameBoard.addTurret(25, 16);
     gameBoard.addTurret(25, 18);
     gameBoard.addTurret(25, 20);
     gameBoard.addTurret(25, 22);
     gameBoard.addTurret(25, 24);
     gameBoard.addTurret(25, 26);
     
     
     // POOL
     
     gameBoard.addPool(22, 28);
     
     gameBoard.addTarget(25, 50, 100);
    
    break;
    }
    
    case 16: // BONUS 7
    {
     playerPos[0] = 18;
     playerPos[1] = 8;
     
     gameBoard.addPool(10, 2);
     
     gameBoard.addWall(8, 0, 13, 'x');
     gameBoard.addWall(8, 1, 10, 'y');
     gameBoard.addWall(9, 10, 9, 'x');
     gameBoard.addWall(20, 1, 8, 'y');
     gameBoard.addWall(17, 11, 8, 'y');
     gameBoard.addWall(19, 10, 9, 'y');
     gameBoard.addWall(18, 18);
    
     gameBoard.addWall(21, 8, 19, 'x');
     gameBoard.addWall(28, 10, 12, 'x');
     gameBoard.addWall(39, 9);
     
     gameBoard.addWall(27, 11);
     gameBoard.addWall(26, 12);
     gameBoard.addWall(25, 13);
     gameBoard.addWall(20, 14, 5, 'x');
     
     gameBoard.addBioTurret(18, 17);
     gameBoard.addBioTurret(38, 9);
    
     gameBoard.addTurret(24, 13);
     gameBoard.addTurret(25, 12);
     gameBoard.addTurret(26, 11);
    
     gameBoard.addTarget(25, 50, 100);
    
    break;
    }
    
    case 10: // BONUS 1
    {
    
     playerPos[0] = 5;
     playerPos[1] = 5;
     
     gameBoard.addPool(24, 14);
     
     gameBoard.addBioTurret(22, 12);
     gameBoard.addBioTurret(26, 12);
     gameBoard.addBioTurret(22, 16);
     gameBoard.addBioTurret(26, 16);
     gameBoard.addTurret(21, 11);
     gameBoard.addTurret(27, 11);
     gameBoard.addTurret(21, 17);
     gameBoard.addTurret(27, 17);
    
     gameBoard.addBioTurret(17, 7);
     gameBoard.addBioTurret(31, 7);
     gameBoard.addBioTurret(17, 21);
     gameBoard.addBioTurret(31, 21);
    
     gameBoard.addWall(18, 8, 3, 'x');
     gameBoard.addWall(18, 9, 2, 'y');
     
     gameBoard.addWall(28, 8, 3, 'x');
     gameBoard.addWall(30, 9, 2, 'y');
     gameBoard.addWall(18, 18, 3, 'y');
     gameBoard.addWall(19, 20, 2, 'x');
     gameBoard.addWall(28, 20, 3, 'x');
     gameBoard.addWall(30, 18, 2, 'y');
     
     
     gameBoard.addTarget(25, 50, 100);
     
     
    
    break;
    }
    
    case 18: // BONUS 9
    {
     playerPos[0] = 38;
     playerPos[1] = 15;
     
     gameBoard.addWall(17, 9, 6, 'x');
     gameBoard.addWall(32, 9, 6, 'x');
     gameBoard.addWall(16, 10);
     gameBoard.addWall(23, 10);
     gameBoard.addWall(31, 10);
     gameBoard.addWall(38, 10);
     gameBoard.addWall(15, 11);
     gameBoard.addWall(24, 11);
     gameBoard.addWall(30, 11);
     gameBoard.addWall(39, 11);
     gameBoard.addWall(14, 12, 7, 'y');
     gameBoard.addWall(25, 12);
     gameBoard.addWall(29, 12);
     gameBoard.addWall(40, 12, 7, 'y');
     gameBoard.addWall(26, 13);
     gameBoard.addWall(28, 13);
     gameBoard.addWall(27, 14);
     
     gameBoard.addWall(27, 16);
     gameBoard.addWall(26, 17);
     gameBoard.addWall(28, 17);
     gameBoard.addWall(25, 18);
     gameBoard.addWall(29, 18);
     gameBoard.addWall(24, 19);
     gameBoard.addWall(30, 19);
     gameBoard.addWall(23, 20);
     gameBoard.addWall(31, 20);
     gameBoard.addWall(17, 21, 6, 'x');
     gameBoard.addWall(32, 21, 6, 'x');
     gameBoard.addWall(16, 20);
     gameBoard.addWall(15, 19);
     gameBoard.addWall(38, 20);
     gameBoard.addWall(39, 19);
     
     gameBoard.addLife(31, 14);
     gameBoard.addLife(30, 14);
     gameBoard.addLife(31, 15);
     gameBoard.addLife(30, 15);
     
     gameBoard.addBioTurret(27, 9);
     gameBoard.addBioTurret(27, 21);
     
     gameBoard.addPool(16, 15);
     
     gameBoard.addTarget(25, 50, 100);
     
     
     
    
    
    break;
    }
    
    case 12: // BONUS 3
    {
    
     playerPos[0] = 42;
     playerPos[1] = 25;
    
     gameBoard.addPool(1, 1);
     
     for(var i = 0; i < 22; i ++)
     {
      gameBoard.addTurret(25+i, 0);
     }
     
     for(var i = 0; i < 13; i ++)
     {
      gameBoard.addTurret(47, 1+i);
     }
     
     for(var i = 0; i < 15; i ++)
     {
      gameBoard.addTurret(0, 14+i);
     }
     
     for(var i = 0; i < 24; i ++)
     {
      gameBoard.addTurret(1+i, 29);
     }
     gameBoard.addLife(38, 20);
     gameBoard.addLife(39, 20);
     gameBoard.addLife(38, 21);
     gameBoard.addLife(40, 21);
     gameBoard.addLife(38, 22);
     
     gameBoard.addTarget(25, 50, 100);
     
    
    break;
    }
    case 13: // BONUS 4
    {
      playerPos[0] = 14;
      playerPos[1] = 9;
      
      gameBoard.addWall(16, 11, 3, 'x');
      gameBoard.addWall(20, 11, 4, 'x');
      gameBoard.addWall(25, 11, 3, 'x');
      
      gameBoard.addWall(16, 12, 2, 'y');
      gameBoard.addWall(27, 12, 2, 'y');
      
      gameBoard.addWall(16, 15, 4, 'y');
      gameBoard.addWall(27, 15, 4, 'y');
      
      gameBoard.addWall(16, 20, 3, 'y');
      gameBoard.addWall(27, 20, 3, 'y');
      
      gameBoard.addWall(17, 22, 2, 'x');      
      gameBoard.addWall(20, 22, 4, 'x');
      gameBoard.addWall(25, 22, 2, 'x');
      
      gameBoard.addBioTurret(19, 13);
      gameBoard.addBioTurret(18, 14);
      gameBoard.addBioTurret(20, 14);
      gameBoard.addBioTurret(19, 15);
      
      gameBoard.addBioTurret(24, 13);
      gameBoard.addBioTurret(23, 14);
      gameBoard.addBioTurret(25, 14);
      gameBoard.addBioTurret(24, 15);
      
      gameBoard.addBioTurret(19, 18);
      gameBoard.addBioTurret(18, 19);
      gameBoard.addBioTurret(20, 19);
      gameBoard.addBioTurret(19, 20);
      
      gameBoard.addBioTurret(24, 18);
      gameBoard.addBioTurret(23, 19);
      gameBoard.addBioTurret(25, 19);
      gameBoard.addBioTurret(24, 20);
      
      gameBoard.addPool(29, 24);
      
      gameBoard.addTarget(25, 50, 100);
    
    
    
    break;
    }
    
    case 17: // BONUS 8
    {
     playerPos[0] = 3;
     playerPos[1] = 26;
     
     gameBoard.addWall(1, 1);
     gameBoard.addWall(2, 2);
     gameBoard.addWall(3, 3);
     gameBoard.addWall(4, 4);
     gameBoard.addWall(5, 5);
     gameBoard.addWall(6, 6);
     gameBoard.addWall(7, 7);
     gameBoard.addWall(8, 8);
     gameBoard.addWall(9, 9);
     gameBoard.addWall(10, 10);
     gameBoard.addWall(11, 11);
     gameBoard.addWall(12, 12);
     gameBoard.addWall(13, 13);
     gameBoard.addWall(14, 14);
     gameBoard.addWall(15, 15);
     gameBoard.addWall(16, 16);
     gameBoard.addWall(17, 17);
     gameBoard.addWall(18, 18);
     gameBoard.addWall(19, 19);
     gameBoard.addWall(20, 20);
     gameBoard.addWall(21, 21);
     gameBoard.addWall(22, 22);
     gameBoard.addWall(23, 23);
     gameBoard.addWall(24, 24);
     gameBoard.addWall(25, 25);
     gameBoard.addWall(26, 26);
     gameBoard.addWall(27, 27);
     gameBoard.addWall(28, 28);
     
     gameBoard.addPool(21, 7);
     
     gameBoard.addBioTurret(28, 0);
     
     gameBoard.addLife(1, 5);
     gameBoard.addLife(2, 5);
     gameBoard.addLife(1, 6);
     gameBoard.addLife(2, 6);
     
     gameBoard.addLife(1, 9);
     gameBoard.addLife(2, 9);
     gameBoard.addLife(1, 10);
     gameBoard.addLife(2, 10);
     
     gameBoard.addLife(5, 9);
     gameBoard.addLife(6, 9);
     gameBoard.addLife(5, 10);
     gameBoard.addLife(6, 10);
     
     gameBoard.addLife(19, 23);
     gameBoard.addLife(20, 23);
     gameBoard.addLife(19, 24);
     gameBoard.addLife(20, 24);
     
     gameBoard.addLife(19, 27);
     gameBoard.addLife(20, 27);
     gameBoard.addLife(19, 28);
     gameBoard.addLife(20, 28);
     
     gameBoard.addLife(23, 27);
     gameBoard.addLife(24, 27);
     gameBoard.addLife(23, 28);
     gameBoard.addLife(24, 28);
    
     gameBoard.addTarget(25, 50, 100);
     
    break;
    }
    
    case 14: // BONUS 5
    {
     playerPos[0] = 34;
     playerPos[1] = 14;
     
     // WALLS
    
     gameBoard.addWall(12, 0, 30, 'y');
     gameBoard.addWall(39, 0, 30, 'y');
     gameBoard.addWall(22, 0, 5, 'y');
     gameBoard.addWall(31, 0, 4, 'y');
     gameBoard.addWall(20, 1, 22, 'y');
     gameBoard.addWall(24, 1, 6, 'x');
     gameBoard.addWall(34, 1, 2, 'x');
     gameBoard.addWall(37, 1, 2, 'x');
     gameBoard.addWall(24, 2, 6, 'x');
     gameBoard.addWall(35, 2, 5, 'y');
     gameBoard.addWall(27, 3, 7, 'y');
     gameBoard.addWall(33, 3, 9, 'y');
     gameBoard.addWall(37, 3, 2, 'y');
     gameBoard.addWall(23, 4, 2, 'x');
     gameBoard.addWall(25, 4, 7, 'y');
     gameBoard.addWall(29, 5, 4, 'x');
     gameBoard.addWall(22, 6, 10, 'y');
     gameBoard.addWall(23, 6, 6, 'y');
     gameBoard.addWall(29, 6, 2, 'y');
     gameBoard.addWall(36, 6, 2, 'x');
     gameBoard.addWall(30, 7, 2, 'x');
     gameBoard.addWall(35, 8, 2, 'y');
     gameBoard.addWall(36, 8, 3, 'x');
     gameBoard.addWall(28, 9, 5, 'x');
     gameBoard.addWall(37, 10, 7, 'y');
     gameBoard.addWall(23, 11, 9, 'x');
     gameBoard.addWall(34, 11, 4, 'x');
     gameBoard.addWall(28, 12, 4, 'y');
     gameBoard.addWall(24, 13, 3, 'x');
     gameBoard.addWall(30, 13, 6, 'x');
     gameBoard.addWall(24, 14);
     gameBoard.addWall(26, 14);
     gameBoard.addWall(30, 14, 4, 'y');
     gameBoard.addWall(35, 14);
     gameBoard.addWall(24, 15, 3, 'x');
     gameBoard.addWall(32, 15, 6, 'x');
     gameBoard.addWall(25, 16);
     gameBoard.addWall(32, 16, 5, 'y');
     gameBoard.addWall(36, 16);
     gameBoard.addWall(22, 17, 9, 'x');
     gameBoard.addWall(34, 17);
     gameBoard.addWall(22, 18, 4, 'y');
     gameBoard.addWall(34, 18, 5, 'x');
     gameBoard.addWall(24, 19, 8, 'x');
     gameBoard.addWall(33, 20, 5, 'x');
     gameBoard.addWall(21, 22, 18, 'x');
     
     // BIO TURRETS
     
     gameBoard.addBioTurret(13, 0);
     gameBoard.addBioTurret(38, 23);
     gameBoard.addBioTurret(19, 29);
     
     // CLASSIC TURRETS
     
     gameBoard.addTurret(16, 1);
     gameBoard.addTurret(16, 28);
     
     gameBoard.addTurret(30, 27);
     gameBoard.addTurret(30, 28);
     gameBoard.addTurret(30, 29);
     
    
     // BLIPS
    
     gameBoard.addLife(15, 7);
     gameBoard.addLife(16, 7);
     gameBoard.addLife(17, 7);
     
     gameBoard.addLife(15, 11);
     gameBoard.addLife(16, 11);
     gameBoard.addLife(17, 11);
     
     gameBoard.addLife(15, 15);
     gameBoard.addLife(16, 15);
     gameBoard.addLife(17, 15);
     
     gameBoard.addLife(15, 19);
     gameBoard.addLife(16, 19);
     gameBoard.addLife(17, 19);
     
     gameBoard.addLife(15, 24);
     gameBoard.addLife(16, 24);
     gameBoard.addLife(17, 24);
     
     
    
     // POOL
     
     gameBoard.addPool(32, 25);
    
     gameBoard.addTarget(25, 50, 100);
    
    
    
    
    
    break;
    }
    
    
    
   }
   
   gameBoard.addPlayer();
   
  }
  else
  {
   //gameBoard.copy(tempBoard);
   gameBoard.addTarget(25, 50, 100);
   playerPos[0] = editMode.Conway_x;
   playerPos[1] = editMode.Conway_y;
  }
 }
 else if(LEVEL_TYPE == "CUSTOM")
 {
  gameBoard.copy(tempBoard);
  //alert("Custom level");
  level = -1;
  gameBoard.addTarget(25, 50, 100);
 }
 
 //gameBoard.addPlayer();
 gameBoard.draw();
 Menu();
 
 LoopRun = setInterval(gameLoop, 250);
}

function saveLevel()
{
 slotsAvailable();

 //customLevels = true;
 gameBoard.clear();
 clearScreen();
 
 ctx.font = "30px Trebuchet MS";
 
 for(var row = 0; row < 3; row ++)
 { 
  for(var col = 0; col < 3; col ++)
  {
   
   ctx.font = "30px Trebuchet MS";
   
   ctx.beginPath();
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 80+2*60*row, 90, 60);
   ctx.stroke();
   
   ctx.lineWidth = "3";
   ctx.strokeStyle = "black";
   ctx.rect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.fillStyle = "white";
   ctx.fillRect(130+2*90*col, 140+2*60*row, 90, 30);
   ctx.stroke();
   
   ctx.fillStyle = "black";
   ctx.fillText( (1+row*3+col) , 167+2*90*col, 120+2*60*row);
   
   if(customSlots[row*3+col] == 0)
   {
    ctx.font = "16px Trebuchet MS";
    //alert("Slot " + (row*3+col));
    ctx.fillStyle = "black";
    ctx.fillText("EMPTY", 150+180*col, 162+120*row);
   
   }
   
  }
 } 
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 //ctx.fillText("Choose a slot to save level", 20, 490);
 //ctx.fillText("Bonus Levels", 515, 490);
 ctx.fillText("Choose a slot to save level", 220, 40);
 ctx.fillText("Cancel", 300, 490);
 
 for(var i = 0; i < 3; i ++)
 {
  ctx.beginPath();
  ctx.lineWidth = "4";
  ctx.rect(i*240, 450, 240, 60);
  ctx.stroke();
 }

}

function victoryScreen()
{
 clearInterval(LoopRun);
 clearScreen();
 
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 
 ctx.fillText("Congratulations! You saved the Blips!", 50, 150);
 ctx.fillText("Click to return to level select...", 100, 360);
 
}

function Instructions()
{
 clearScreen();
 instructOn = true;
 
 ctx.font = "30px Trebuchet MS";
 ctx.fillStyle = "black";
 
 ctx.fillText("Instructions", 280, 50);
 
 for(var i = 0; i < 3; i ++)
 {
 
  ctx.beginPath();
  ctx.lineWidth = "3";
  ctx.rect(i*240, 450, 240, 60);
  ctx.stroke(); 
 }
 
 
 ctx.fillText("Main Menu", 285, 490);
 
 ctx.font = "72px Trebuchet MS";
 
   if(pageNo != 0)
 {
  ctx.fillText("<", 90, 502);
 }
 
 if(pageNo != 1)
 { 
  ctx.fillText(">", 580, 502);
 } 
 
 ctx.font = "bold italic 20px Trebuchet MS";
 
 
 
 switch(pageNo)
 {
  case 0:
  {
   ctx.fillText("Objective", 60, 100);
   ctx.fillText("Conway the Shepherd", 60, 180);
   ctx.fillText("The Blips", 60, 280);
   ctx.fillText("Walls", 60, 400);
   
   ctx.font = "16px Trebuchet MS";
   
   ctx.fillText("The goal of Blip Shepherd is to get as many Blips as you can to the pool!", 60, 125);
   
   ctx.fillText("You play as Conway!", 60, 205); 
   ctx.fillText("Herd the Blips by moving near them, using the WASD controls or arrow keys to move.", 60, 225);
   
   ctx.fillText("Unusual litte creatures, their population evolves somewhat eratically", 60, 305);
   ctx.fillText("depending on how many of their fellow Blips they are near.", 60, 325);
   ctx.fillText("Get as many of these guys as you can to the pool to win each level!", 60, 345);
   
   ctx.fillText("These are walls...they get in the way of stuff!", 60, 425);
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(300, 165, 15, 15);
   ctx.fillStyle = "green";
   ctx.fillRect(300, 165, 15, 15);
   ctx.stroke();
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(300, 265, 15, 15);
   ctx.fillStyle = "yellow";
   ctx.fillRect(300, 265, 15, 15);
   ctx.stroke();
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(300, 385, 15, 15);
   ctx.fillStyle = "black";
   ctx.fillRect(300, 385, 15, 15);
   ctx.stroke();
   
  break;
  }
  
  case 1:
  {
   ctx.fillText("The Pool", 60, 100);
   ctx.fillText("Turrets", 60, 230);
   ctx.fillText("Bio Turrets", 60, 310);
   
   ctx.font = "16px Trebuchet MS";
   
   ctx.fillText("The Pool teleports Blips away to safety!", 60, 125);
   ctx.fillText("Far away from whatever hellish land they", 60, 145);
   ctx.fillText("find themselves in!", 60, 165);
   
   ctx.fillText("These nasty chaps shoot red bullets at your Blips to try to kill them! The rotters!", 60, 255);
   
   ctx.fillText("BIOLOGICAL WARFARE!!! OMG!!! These turrets fire Pseudo Blips at your herd to disrupt", 60, 335);
   ctx.fillText("their population evolution!", 60, 355);
   
   ctx.fillText("...oh and press P to pause!", 510, 440);
   ctx.fillText("Press Esc on the title screen to reset save data!", 10, 440);
   for(var i = 0; i < 3; i ++)
   {
    for(var j = 0; j < 3; j ++)
    {
     if(i != 1 || j != 1)
     {
      ctx.beginPath();
      ctx.lineWidth = "0.75";
      ctx.strokeStyle = "black";
      ctx.rect(375+i*15, 115+j*15, 15, 15);
      ctx.fillStyle = "blue";
      ctx.fillRect(375+i*15, 115+j*15, 15, 15);
      ctx.stroke();
     }
    }
   }
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(300, 215, 15, 15);
   ctx.fillStyle = "brown";
   ctx.fillRect(300, 215, 15, 15);
   ctx.stroke();
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(315, 215, 15, 15);
   ctx.fillStyle = "red";
   ctx.fillRect(315, 215, 15, 15);
   ctx.stroke();
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(300, 295, 15, 15);
   ctx.fillStyle = "mediumvioletred";
   ctx.fillRect(300, 295, 15, 15);
   ctx.stroke();
   
   ctx.beginPath();
   ctx.lineWidth = "0.75";
   ctx.strokeStyle = "black";
   ctx.rect(315, 295, 15, 15);
   ctx.fillStyle = "purple";
   ctx.fillRect(315, 295, 15, 15);
   ctx.stroke();
   
   
  break;
  }
 }
}

var LoopRun;

var TitleScreen = false;
var LevelSel = false;
var customLevels = false;
var bonusLevels = false;
var gameOn = false;
var Editor = false;
var testMode = false;
var canSave = false;
var VictoryOn = false;
var instructOn = false;
var finishOn = false;
var Go = false;

var pageNo = 0;
var level = 0;


var trophy = 'n';
var trophies = new Array(18);

var totalPoints = 0;

for(var i = 0; i < 18; i ++)
{
 trophies[i] = 'n';
}

var customSlots = new Array(9);

for(var i = 0; i < 9; i ++)
{
 customSlots[i] = 0;
}

var lvlType = "NORMAL";

var unlockThresh = [ 0, 1, 2, 9, 12, 15, 30, 35, 40 ];

var gameBoard = new grid(48, 30);

var tempBoard = new grid(48, 30);

var playerPos = new Array(2);
var editMode = new editor("Ed");

var safe = 0;



if(localStorage.getItem("trophies")=== null)
{

 localStorage.setItem("trophies", JSON.stringify(trophies));
 
 
 /*var test = localStorage.getItem("trophies");
 console.log(test);*/
}
else if(localStorage.getItem("trophies").length == 37)
{
 var loadTrophies = localStorage.getItem("trophies");
 //alert("Extend trophies!");
 var oldTrophies = new Array(9);
 for(var i = 0; i < 9; i ++)
 {
  oldTrophies[i] = loadTrophies[2+i*4];
  //alert("oldTrophies[" + i + "] = " + oldTrophies[i]);
  
  trophies[i] = oldTrophies[i];
 }
 
 localStorage.setItem("trophies", JSON.stringify(trophies));

}
/*else
{
 alert(localStorage.getItem("trophies"));
}*/

if(localStorage.getItem("customLvls") === null)
{
 localStorage.setItem("customLvls", JSON.stringify(customSlots));
 

}

titleScreen();



</script>

<br />
<header>

<br />
<b>Controls</b>

</header>

<body>
<br />
Arrow Keys/WASD to move<br />
P to Pause<br />
Esc on Title Screen to clear save data<br />
<br><br>
<a href="http://goo.gl/E46XAT">Play Original.</a>

</body>

